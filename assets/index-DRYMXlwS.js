(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))f(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&f(p)}).observe(document,{childList:!0,subtree:!0});function n(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function f(l){if(l.ep)return;l.ep=!0;const h=n(l);fetch(l.href,h)}})();function Sn(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function Kn(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var e=a.default;if(typeof e=="function"){var n=function f(){return this instanceof f?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(a).forEach(function(f){var l=Object.getOwnPropertyDescriptor(a,f);Object.defineProperty(n,f,l.get?l:{enumerable:!0,get:function(){return a[f]}})}),n}var lt={exports:{}},On=lt.exports,hn;function Fn(){return hn||(hn=1,function(a){(function(e,n){a.exports?a.exports=n():(e.nacl||(e.nacl={}),e.nacl.util=n())})(On,function(){var e={};function n(f){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(f))throw new TypeError("invalid encoding")}return e.decodeUTF8=function(f){if(typeof f!="string")throw new TypeError("expected string");var l,h=unescape(encodeURIComponent(f)),p=new Uint8Array(h.length);for(l=0;l<h.length;l++)p[l]=h.charCodeAt(l);return p},e.encodeUTF8=function(f){var l,h=[];for(l=0;l<f.length;l++)h.push(String.fromCharCode(f[l]));return decodeURIComponent(escape(h.join("")))},typeof atob>"u"?typeof Buffer.from<"u"?(e.encodeBase64=function(f){return Buffer.from(f).toString("base64")},e.decodeBase64=function(f){return n(f),new Uint8Array(Array.prototype.slice.call(Buffer.from(f,"base64"),0))}):(e.encodeBase64=function(f){return new Buffer(f).toString("base64")},e.decodeBase64=function(f){return n(f),new Uint8Array(Array.prototype.slice.call(new Buffer(f,"base64"),0))}):(e.encodeBase64=function(f){var l,h=[],p=f.length;for(l=0;l<p;l++)h.push(String.fromCharCode(f[l]));return btoa(h.join(""))},e.decodeBase64=function(f){n(f);var l,h=atob(f),p=new Uint8Array(h.length);for(l=0;l<h.length;l++)p[l]=h.charCodeAt(l);return p}),e})}(lt)),lt.exports}var qn=Fn();const He=Sn(qn);function Dn(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var kt={exports:{}};const Yn={},Gn=Object.freeze(Object.defineProperty({__proto__:null,default:Yn},Symbol.toStringTag,{value:"Module"})),$n=Kn(Gn);var xn;function Hn(){return xn||(xn=1,function(a){(function(e){var n=function(r){var o,i=new Float64Array(16);if(r)for(o=0;o<r.length;o++)i[o]=r[o];return i},f=function(){throw new Error("no PRNG")},l=new Uint8Array(16),h=new Uint8Array(32);h[0]=9;var p=n(),m=n([1]),H=n([56129,1]),q=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),re=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),V=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),de=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),ye=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function ue(r,o,i,t){r[o]=i>>24&255,r[o+1]=i>>16&255,r[o+2]=i>>8&255,r[o+3]=i&255,r[o+4]=t>>24&255,r[o+5]=t>>16&255,r[o+6]=t>>8&255,r[o+7]=t&255}function Re(r,o,i,t,s){var d,u=0;for(d=0;d<s;d++)u|=r[o+d]^i[t+d];return(1&u-1>>>8)-1}function Xe(r,o,i,t){return Re(r,o,i,t,16)}function wt(r,o,i,t){return Re(r,o,i,t,32)}function An(r,o,i,t){for(var s=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,d=i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24,u=i[4]&255|(i[5]&255)<<8|(i[6]&255)<<16|(i[7]&255)<<24,b=i[8]&255|(i[9]&255)<<8|(i[10]&255)<<16|(i[11]&255)<<24,S=i[12]&255|(i[13]&255)<<8|(i[14]&255)<<16|(i[15]&255)<<24,L=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,U=o[0]&255|(o[1]&255)<<8|(o[2]&255)<<16|(o[3]&255)<<24,ee=o[4]&255|(o[5]&255)<<8|(o[6]&255)<<16|(o[7]&255)<<24,R=o[8]&255|(o[9]&255)<<8|(o[10]&255)<<16|(o[11]&255)<<24,I=o[12]&255|(o[13]&255)<<8|(o[14]&255)<<16|(o[15]&255)<<24,k=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,D=i[16]&255|(i[17]&255)<<8|(i[18]&255)<<16|(i[19]&255)<<24,F=i[20]&255|(i[21]&255)<<8|(i[22]&255)<<16|(i[23]&255)<<24,N=i[24]&255|(i[25]&255)<<8|(i[26]&255)<<16|(i[27]&255)<<24,O=i[28]&255|(i[29]&255)<<8|(i[30]&255)<<16|(i[31]&255)<<24,K=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,P=s,W=d,C=u,A=b,j=S,E=L,x=U,g=ee,w=R,v=I,y=k,_=D,M=F,Y=N,$=O,G=K,c,z=0;z<20;z+=2)c=P+M|0,j^=c<<7|c>>>25,c=j+P|0,w^=c<<9|c>>>23,c=w+j|0,M^=c<<13|c>>>19,c=M+w|0,P^=c<<18|c>>>14,c=E+W|0,v^=c<<7|c>>>25,c=v+E|0,Y^=c<<9|c>>>23,c=Y+v|0,W^=c<<13|c>>>19,c=W+Y|0,E^=c<<18|c>>>14,c=y+x|0,$^=c<<7|c>>>25,c=$+y|0,C^=c<<9|c>>>23,c=C+$|0,x^=c<<13|c>>>19,c=x+C|0,y^=c<<18|c>>>14,c=G+_|0,A^=c<<7|c>>>25,c=A+G|0,g^=c<<9|c>>>23,c=g+A|0,_^=c<<13|c>>>19,c=_+g|0,G^=c<<18|c>>>14,c=P+A|0,W^=c<<7|c>>>25,c=W+P|0,C^=c<<9|c>>>23,c=C+W|0,A^=c<<13|c>>>19,c=A+C|0,P^=c<<18|c>>>14,c=E+j|0,x^=c<<7|c>>>25,c=x+E|0,g^=c<<9|c>>>23,c=g+x|0,j^=c<<13|c>>>19,c=j+g|0,E^=c<<18|c>>>14,c=y+v|0,_^=c<<7|c>>>25,c=_+y|0,w^=c<<9|c>>>23,c=w+_|0,v^=c<<13|c>>>19,c=v+w|0,y^=c<<18|c>>>14,c=G+$|0,M^=c<<7|c>>>25,c=M+G|0,Y^=c<<9|c>>>23,c=Y+M|0,$^=c<<13|c>>>19,c=$+Y|0,G^=c<<18|c>>>14;P=P+s|0,W=W+d|0,C=C+u|0,A=A+b|0,j=j+S|0,E=E+L|0,x=x+U|0,g=g+ee|0,w=w+R|0,v=v+I|0,y=y+k|0,_=_+D|0,M=M+F|0,Y=Y+N|0,$=$+O|0,G=G+K|0,r[0]=P>>>0&255,r[1]=P>>>8&255,r[2]=P>>>16&255,r[3]=P>>>24&255,r[4]=W>>>0&255,r[5]=W>>>8&255,r[6]=W>>>16&255,r[7]=W>>>24&255,r[8]=C>>>0&255,r[9]=C>>>8&255,r[10]=C>>>16&255,r[11]=C>>>24&255,r[12]=A>>>0&255,r[13]=A>>>8&255,r[14]=A>>>16&255,r[15]=A>>>24&255,r[16]=j>>>0&255,r[17]=j>>>8&255,r[18]=j>>>16&255,r[19]=j>>>24&255,r[20]=E>>>0&255,r[21]=E>>>8&255,r[22]=E>>>16&255,r[23]=E>>>24&255,r[24]=x>>>0&255,r[25]=x>>>8&255,r[26]=x>>>16&255,r[27]=x>>>24&255,r[28]=g>>>0&255,r[29]=g>>>8&255,r[30]=g>>>16&255,r[31]=g>>>24&255,r[32]=w>>>0&255,r[33]=w>>>8&255,r[34]=w>>>16&255,r[35]=w>>>24&255,r[36]=v>>>0&255,r[37]=v>>>8&255,r[38]=v>>>16&255,r[39]=v>>>24&255,r[40]=y>>>0&255,r[41]=y>>>8&255,r[42]=y>>>16&255,r[43]=y>>>24&255,r[44]=_>>>0&255,r[45]=_>>>8&255,r[46]=_>>>16&255,r[47]=_>>>24&255,r[48]=M>>>0&255,r[49]=M>>>8&255,r[50]=M>>>16&255,r[51]=M>>>24&255,r[52]=Y>>>0&255,r[53]=Y>>>8&255,r[54]=Y>>>16&255,r[55]=Y>>>24&255,r[56]=$>>>0&255,r[57]=$>>>8&255,r[58]=$>>>16&255,r[59]=$>>>24&255,r[60]=G>>>0&255,r[61]=G>>>8&255,r[62]=G>>>16&255,r[63]=G>>>24&255}function jn(r,o,i,t){for(var s=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,d=i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24,u=i[4]&255|(i[5]&255)<<8|(i[6]&255)<<16|(i[7]&255)<<24,b=i[8]&255|(i[9]&255)<<8|(i[10]&255)<<16|(i[11]&255)<<24,S=i[12]&255|(i[13]&255)<<8|(i[14]&255)<<16|(i[15]&255)<<24,L=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,U=o[0]&255|(o[1]&255)<<8|(o[2]&255)<<16|(o[3]&255)<<24,ee=o[4]&255|(o[5]&255)<<8|(o[6]&255)<<16|(o[7]&255)<<24,R=o[8]&255|(o[9]&255)<<8|(o[10]&255)<<16|(o[11]&255)<<24,I=o[12]&255|(o[13]&255)<<8|(o[14]&255)<<16|(o[15]&255)<<24,k=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,D=i[16]&255|(i[17]&255)<<8|(i[18]&255)<<16|(i[19]&255)<<24,F=i[20]&255|(i[21]&255)<<8|(i[22]&255)<<16|(i[23]&255)<<24,N=i[24]&255|(i[25]&255)<<8|(i[26]&255)<<16|(i[27]&255)<<24,O=i[28]&255|(i[29]&255)<<8|(i[30]&255)<<16|(i[31]&255)<<24,K=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,P=s,W=d,C=u,A=b,j=S,E=L,x=U,g=ee,w=R,v=I,y=k,_=D,M=F,Y=N,$=O,G=K,c,z=0;z<20;z+=2)c=P+M|0,j^=c<<7|c>>>25,c=j+P|0,w^=c<<9|c>>>23,c=w+j|0,M^=c<<13|c>>>19,c=M+w|0,P^=c<<18|c>>>14,c=E+W|0,v^=c<<7|c>>>25,c=v+E|0,Y^=c<<9|c>>>23,c=Y+v|0,W^=c<<13|c>>>19,c=W+Y|0,E^=c<<18|c>>>14,c=y+x|0,$^=c<<7|c>>>25,c=$+y|0,C^=c<<9|c>>>23,c=C+$|0,x^=c<<13|c>>>19,c=x+C|0,y^=c<<18|c>>>14,c=G+_|0,A^=c<<7|c>>>25,c=A+G|0,g^=c<<9|c>>>23,c=g+A|0,_^=c<<13|c>>>19,c=_+g|0,G^=c<<18|c>>>14,c=P+A|0,W^=c<<7|c>>>25,c=W+P|0,C^=c<<9|c>>>23,c=C+W|0,A^=c<<13|c>>>19,c=A+C|0,P^=c<<18|c>>>14,c=E+j|0,x^=c<<7|c>>>25,c=x+E|0,g^=c<<9|c>>>23,c=g+x|0,j^=c<<13|c>>>19,c=j+g|0,E^=c<<18|c>>>14,c=y+v|0,_^=c<<7|c>>>25,c=_+y|0,w^=c<<9|c>>>23,c=w+_|0,v^=c<<13|c>>>19,c=v+w|0,y^=c<<18|c>>>14,c=G+$|0,M^=c<<7|c>>>25,c=M+G|0,Y^=c<<9|c>>>23,c=Y+M|0,$^=c<<13|c>>>19,c=$+Y|0,G^=c<<18|c>>>14;r[0]=P>>>0&255,r[1]=P>>>8&255,r[2]=P>>>16&255,r[3]=P>>>24&255,r[4]=E>>>0&255,r[5]=E>>>8&255,r[6]=E>>>16&255,r[7]=E>>>24&255,r[8]=y>>>0&255,r[9]=y>>>8&255,r[10]=y>>>16&255,r[11]=y>>>24&255,r[12]=G>>>0&255,r[13]=G>>>8&255,r[14]=G>>>16&255,r[15]=G>>>24&255,r[16]=x>>>0&255,r[17]=x>>>8&255,r[18]=x>>>16&255,r[19]=x>>>24&255,r[20]=g>>>0&255,r[21]=g>>>8&255,r[22]=g>>>16&255,r[23]=g>>>24&255,r[24]=w>>>0&255,r[25]=w>>>8&255,r[26]=w>>>16&255,r[27]=w>>>24&255,r[28]=v>>>0&255,r[29]=v>>>8&255,r[30]=v>>>16&255,r[31]=v>>>24&255}function Ze(r,o,i,t){An(r,o,i,t)}function Qe(r,o,i,t){jn(r,o,i,t)}var Pe=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function zt(r,o,i,t,s,d,u){var b=new Uint8Array(16),S=new Uint8Array(64),L,U;for(U=0;U<16;U++)b[U]=0;for(U=0;U<8;U++)b[U]=d[U];for(;s>=64;){for(Ze(S,b,u,Pe),U=0;U<64;U++)r[o+U]=i[t+U]^S[U];for(L=1,U=8;U<16;U++)L=L+(b[U]&255)|0,b[U]=L&255,L>>>=8;s-=64,o+=64,t+=64}if(s>0)for(Ze(S,b,u,Pe),U=0;U<s;U++)r[o+U]=i[t+U]^S[U];return 0}function Xt(r,o,i,t,s){var d=new Uint8Array(16),u=new Uint8Array(64),b,S;for(S=0;S<16;S++)d[S]=0;for(S=0;S<8;S++)d[S]=t[S];for(;i>=64;){for(Ze(u,d,s,Pe),S=0;S<64;S++)r[o+S]=u[S];for(b=1,S=8;S<16;S++)b=b+(d[S]&255)|0,d[S]=b&255,b>>>=8;i-=64,o+=64}if(i>0)for(Ze(u,d,s,Pe),S=0;S<i;S++)r[o+S]=u[S];return 0}function Zt(r,o,i,t,s){var d=new Uint8Array(32);Qe(d,t,s,Pe);for(var u=new Uint8Array(8),b=0;b<8;b++)u[b]=t[b+16];return Xt(r,o,i,u,d)}function mt(r,o,i,t,s,d,u){var b=new Uint8Array(32);Qe(b,d,u,Pe);for(var S=new Uint8Array(8),L=0;L<8;L++)S[L]=d[L+16];return zt(r,o,i,t,s,S,b)}var Ve=function(r){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var o,i,t,s,d,u,b,S;o=r[0]&255|(r[1]&255)<<8,this.r[0]=o&8191,i=r[2]&255|(r[3]&255)<<8,this.r[1]=(o>>>13|i<<3)&8191,t=r[4]&255|(r[5]&255)<<8,this.r[2]=(i>>>10|t<<6)&7939,s=r[6]&255|(r[7]&255)<<8,this.r[3]=(t>>>7|s<<9)&8191,d=r[8]&255|(r[9]&255)<<8,this.r[4]=(s>>>4|d<<12)&255,this.r[5]=d>>>1&8190,u=r[10]&255|(r[11]&255)<<8,this.r[6]=(d>>>14|u<<2)&8191,b=r[12]&255|(r[13]&255)<<8,this.r[7]=(u>>>11|b<<5)&8065,S=r[14]&255|(r[15]&255)<<8,this.r[8]=(b>>>8|S<<8)&8191,this.r[9]=S>>>5&127,this.pad[0]=r[16]&255|(r[17]&255)<<8,this.pad[1]=r[18]&255|(r[19]&255)<<8,this.pad[2]=r[20]&255|(r[21]&255)<<8,this.pad[3]=r[22]&255|(r[23]&255)<<8,this.pad[4]=r[24]&255|(r[25]&255)<<8,this.pad[5]=r[26]&255|(r[27]&255)<<8,this.pad[6]=r[28]&255|(r[29]&255)<<8,this.pad[7]=r[30]&255|(r[31]&255)<<8};Ve.prototype.blocks=function(r,o,i){for(var t=this.fin?0:2048,s,d,u,b,S,L,U,ee,R,I,k,D,F,N,O,K,P,W,C,A=this.h[0],j=this.h[1],E=this.h[2],x=this.h[3],g=this.h[4],w=this.h[5],v=this.h[6],y=this.h[7],_=this.h[8],M=this.h[9],Y=this.r[0],$=this.r[1],G=this.r[2],c=this.r[3],z=this.r[4],te=this.r[5],ne=this.r[6],J=this.r[7],Z=this.r[8],Q=this.r[9];i>=16;)s=r[o+0]&255|(r[o+1]&255)<<8,A+=s&8191,d=r[o+2]&255|(r[o+3]&255)<<8,j+=(s>>>13|d<<3)&8191,u=r[o+4]&255|(r[o+5]&255)<<8,E+=(d>>>10|u<<6)&8191,b=r[o+6]&255|(r[o+7]&255)<<8,x+=(u>>>7|b<<9)&8191,S=r[o+8]&255|(r[o+9]&255)<<8,g+=(b>>>4|S<<12)&8191,w+=S>>>1&8191,L=r[o+10]&255|(r[o+11]&255)<<8,v+=(S>>>14|L<<2)&8191,U=r[o+12]&255|(r[o+13]&255)<<8,y+=(L>>>11|U<<5)&8191,ee=r[o+14]&255|(r[o+15]&255)<<8,_+=(U>>>8|ee<<8)&8191,M+=ee>>>5|t,R=0,I=R,I+=A*Y,I+=j*(5*Q),I+=E*(5*Z),I+=x*(5*J),I+=g*(5*ne),R=I>>>13,I&=8191,I+=w*(5*te),I+=v*(5*z),I+=y*(5*c),I+=_*(5*G),I+=M*(5*$),R+=I>>>13,I&=8191,k=R,k+=A*$,k+=j*Y,k+=E*(5*Q),k+=x*(5*Z),k+=g*(5*J),R=k>>>13,k&=8191,k+=w*(5*ne),k+=v*(5*te),k+=y*(5*z),k+=_*(5*c),k+=M*(5*G),R+=k>>>13,k&=8191,D=R,D+=A*G,D+=j*$,D+=E*Y,D+=x*(5*Q),D+=g*(5*Z),R=D>>>13,D&=8191,D+=w*(5*J),D+=v*(5*ne),D+=y*(5*te),D+=_*(5*z),D+=M*(5*c),R+=D>>>13,D&=8191,F=R,F+=A*c,F+=j*G,F+=E*$,F+=x*Y,F+=g*(5*Q),R=F>>>13,F&=8191,F+=w*(5*Z),F+=v*(5*J),F+=y*(5*ne),F+=_*(5*te),F+=M*(5*z),R+=F>>>13,F&=8191,N=R,N+=A*z,N+=j*c,N+=E*G,N+=x*$,N+=g*Y,R=N>>>13,N&=8191,N+=w*(5*Q),N+=v*(5*Z),N+=y*(5*J),N+=_*(5*ne),N+=M*(5*te),R+=N>>>13,N&=8191,O=R,O+=A*te,O+=j*z,O+=E*c,O+=x*G,O+=g*$,R=O>>>13,O&=8191,O+=w*Y,O+=v*(5*Q),O+=y*(5*Z),O+=_*(5*J),O+=M*(5*ne),R+=O>>>13,O&=8191,K=R,K+=A*ne,K+=j*te,K+=E*z,K+=x*c,K+=g*G,R=K>>>13,K&=8191,K+=w*$,K+=v*Y,K+=y*(5*Q),K+=_*(5*Z),K+=M*(5*J),R+=K>>>13,K&=8191,P=R,P+=A*J,P+=j*ne,P+=E*te,P+=x*z,P+=g*c,R=P>>>13,P&=8191,P+=w*G,P+=v*$,P+=y*Y,P+=_*(5*Q),P+=M*(5*Z),R+=P>>>13,P&=8191,W=R,W+=A*Z,W+=j*J,W+=E*ne,W+=x*te,W+=g*z,R=W>>>13,W&=8191,W+=w*c,W+=v*G,W+=y*$,W+=_*Y,W+=M*(5*Q),R+=W>>>13,W&=8191,C=R,C+=A*Q,C+=j*Z,C+=E*J,C+=x*ne,C+=g*te,R=C>>>13,C&=8191,C+=w*z,C+=v*c,C+=y*G,C+=_*$,C+=M*Y,R+=C>>>13,C&=8191,R=(R<<2)+R|0,R=R+I|0,I=R&8191,R=R>>>13,k+=R,A=I,j=k,E=D,x=F,g=N,w=O,v=K,y=P,_=W,M=C,o+=16,i-=16;this.h[0]=A,this.h[1]=j,this.h[2]=E,this.h[3]=x,this.h[4]=g,this.h[5]=w,this.h[6]=v,this.h[7]=y,this.h[8]=_,this.h[9]=M},Ve.prototype.finish=function(r,o){var i=new Uint16Array(10),t,s,d,u;if(this.leftover){for(u=this.leftover,this.buffer[u++]=1;u<16;u++)this.buffer[u]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(t=this.h[1]>>>13,this.h[1]&=8191,u=2;u<10;u++)this.h[u]+=t,t=this.h[u]>>>13,this.h[u]&=8191;for(this.h[0]+=t*5,t=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=t,t=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=t,i[0]=this.h[0]+5,t=i[0]>>>13,i[0]&=8191,u=1;u<10;u++)i[u]=this.h[u]+t,t=i[u]>>>13,i[u]&=8191;for(i[9]-=8192,s=(t^1)-1,u=0;u<10;u++)i[u]&=s;for(s=~s,u=0;u<10;u++)this.h[u]=this.h[u]&s|i[u];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,d=this.h[0]+this.pad[0],this.h[0]=d&65535,u=1;u<8;u++)d=(this.h[u]+this.pad[u]|0)+(d>>>16)|0,this.h[u]=d&65535;r[o+0]=this.h[0]>>>0&255,r[o+1]=this.h[0]>>>8&255,r[o+2]=this.h[1]>>>0&255,r[o+3]=this.h[1]>>>8&255,r[o+4]=this.h[2]>>>0&255,r[o+5]=this.h[2]>>>8&255,r[o+6]=this.h[3]>>>0&255,r[o+7]=this.h[3]>>>8&255,r[o+8]=this.h[4]>>>0&255,r[o+9]=this.h[4]>>>8&255,r[o+10]=this.h[5]>>>0&255,r[o+11]=this.h[5]>>>8&255,r[o+12]=this.h[6]>>>0&255,r[o+13]=this.h[6]>>>8&255,r[o+14]=this.h[7]>>>0&255,r[o+15]=this.h[7]>>>8&255},Ve.prototype.update=function(r,o,i){var t,s;if(this.leftover){for(s=16-this.leftover,s>i&&(s=i),t=0;t<s;t++)this.buffer[this.leftover+t]=r[o+t];if(i-=s,o+=s,this.leftover+=s,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(i>=16&&(s=i-i%16,this.blocks(r,o,s),o+=s,i-=s),i){for(t=0;t<i;t++)this.buffer[this.leftover+t]=r[o+t];this.leftover+=i}};function _t(r,o,i,t,s,d){var u=new Ve(d);return u.update(i,t,s),u.finish(r,o),0}function Qt(r,o,i,t,s,d){var u=new Uint8Array(16);return _t(u,0,i,t,s,d),Xe(r,o,u,0)}function St(r,o,i,t,s){var d;if(i<32)return-1;for(mt(r,0,o,0,i,t,s),_t(r,16,r,32,i-32,r),d=0;d<16;d++)r[d]=0;return 0}function Et(r,o,i,t,s){var d,u=new Uint8Array(32);if(i<32||(Zt(u,0,32,t,s),Qt(o,16,o,32,i-32,u)!==0))return-1;for(mt(r,0,o,0,i,t,s),d=0;d<32;d++)r[d]=0;return 0}function Se(r,o){var i;for(i=0;i<16;i++)r[i]=o[i]|0}function Ut(r){var o,i,t=1;for(o=0;o<16;o++)i=r[o]+t+65535,t=Math.floor(i/65536),r[o]=i-t*65536;r[0]+=t-1+37*(t-1)}function Le(r,o,i){for(var t,s=~(i-1),d=0;d<16;d++)t=s&(r[d]^o[d]),r[d]^=t,o[d]^=t}function We(r,o){var i,t,s,d=n(),u=n();for(i=0;i<16;i++)u[i]=o[i];for(Ut(u),Ut(u),Ut(u),t=0;t<2;t++){for(d[0]=u[0]-65517,i=1;i<15;i++)d[i]=u[i]-65535-(d[i-1]>>16&1),d[i-1]&=65535;d[15]=u[15]-32767-(d[14]>>16&1),s=d[15]>>16&1,d[14]&=65535,Le(u,d,1-s)}for(i=0;i<16;i++)r[2*i]=u[i]&255,r[2*i+1]=u[i]>>8}function Vt(r,o){var i=new Uint8Array(32),t=new Uint8Array(32);return We(i,r),We(t,o),wt(i,0,t,0)}function en(r){var o=new Uint8Array(32);return We(o,r),o[0]&1}function Ct(r,o){var i;for(i=0;i<16;i++)r[i]=o[2*i]+(o[2*i+1]<<8);r[15]&=32767}function we(r,o,i){for(var t=0;t<16;t++)r[t]=o[t]+i[t]}function me(r,o,i){for(var t=0;t<16;t++)r[t]=o[t]-i[t]}function X(r,o,i){var t,s,d=0,u=0,b=0,S=0,L=0,U=0,ee=0,R=0,I=0,k=0,D=0,F=0,N=0,O=0,K=0,P=0,W=0,C=0,A=0,j=0,E=0,x=0,g=0,w=0,v=0,y=0,_=0,M=0,Y=0,$=0,G=0,c=i[0],z=i[1],te=i[2],ne=i[3],J=i[4],Z=i[5],Q=i[6],fe=i[7],ie=i[8],oe=i[9],se=i[10],ae=i[11],ce=i[12],he=i[13],xe=i[14],ge=i[15];t=o[0],d+=t*c,u+=t*z,b+=t*te,S+=t*ne,L+=t*J,U+=t*Z,ee+=t*Q,R+=t*fe,I+=t*ie,k+=t*oe,D+=t*se,F+=t*ae,N+=t*ce,O+=t*he,K+=t*xe,P+=t*ge,t=o[1],u+=t*c,b+=t*z,S+=t*te,L+=t*ne,U+=t*J,ee+=t*Z,R+=t*Q,I+=t*fe,k+=t*ie,D+=t*oe,F+=t*se,N+=t*ae,O+=t*ce,K+=t*he,P+=t*xe,W+=t*ge,t=o[2],b+=t*c,S+=t*z,L+=t*te,U+=t*ne,ee+=t*J,R+=t*Z,I+=t*Q,k+=t*fe,D+=t*ie,F+=t*oe,N+=t*se,O+=t*ae,K+=t*ce,P+=t*he,W+=t*xe,C+=t*ge,t=o[3],S+=t*c,L+=t*z,U+=t*te,ee+=t*ne,R+=t*J,I+=t*Z,k+=t*Q,D+=t*fe,F+=t*ie,N+=t*oe,O+=t*se,K+=t*ae,P+=t*ce,W+=t*he,C+=t*xe,A+=t*ge,t=o[4],L+=t*c,U+=t*z,ee+=t*te,R+=t*ne,I+=t*J,k+=t*Z,D+=t*Q,F+=t*fe,N+=t*ie,O+=t*oe,K+=t*se,P+=t*ae,W+=t*ce,C+=t*he,A+=t*xe,j+=t*ge,t=o[5],U+=t*c,ee+=t*z,R+=t*te,I+=t*ne,k+=t*J,D+=t*Z,F+=t*Q,N+=t*fe,O+=t*ie,K+=t*oe,P+=t*se,W+=t*ae,C+=t*ce,A+=t*he,j+=t*xe,E+=t*ge,t=o[6],ee+=t*c,R+=t*z,I+=t*te,k+=t*ne,D+=t*J,F+=t*Z,N+=t*Q,O+=t*fe,K+=t*ie,P+=t*oe,W+=t*se,C+=t*ae,A+=t*ce,j+=t*he,E+=t*xe,x+=t*ge,t=o[7],R+=t*c,I+=t*z,k+=t*te,D+=t*ne,F+=t*J,N+=t*Z,O+=t*Q,K+=t*fe,P+=t*ie,W+=t*oe,C+=t*se,A+=t*ae,j+=t*ce,E+=t*he,x+=t*xe,g+=t*ge,t=o[8],I+=t*c,k+=t*z,D+=t*te,F+=t*ne,N+=t*J,O+=t*Z,K+=t*Q,P+=t*fe,W+=t*ie,C+=t*oe,A+=t*se,j+=t*ae,E+=t*ce,x+=t*he,g+=t*xe,w+=t*ge,t=o[9],k+=t*c,D+=t*z,F+=t*te,N+=t*ne,O+=t*J,K+=t*Z,P+=t*Q,W+=t*fe,C+=t*ie,A+=t*oe,j+=t*se,E+=t*ae,x+=t*ce,g+=t*he,w+=t*xe,v+=t*ge,t=o[10],D+=t*c,F+=t*z,N+=t*te,O+=t*ne,K+=t*J,P+=t*Z,W+=t*Q,C+=t*fe,A+=t*ie,j+=t*oe,E+=t*se,x+=t*ae,g+=t*ce,w+=t*he,v+=t*xe,y+=t*ge,t=o[11],F+=t*c,N+=t*z,O+=t*te,K+=t*ne,P+=t*J,W+=t*Z,C+=t*Q,A+=t*fe,j+=t*ie,E+=t*oe,x+=t*se,g+=t*ae,w+=t*ce,v+=t*he,y+=t*xe,_+=t*ge,t=o[12],N+=t*c,O+=t*z,K+=t*te,P+=t*ne,W+=t*J,C+=t*Z,A+=t*Q,j+=t*fe,E+=t*ie,x+=t*oe,g+=t*se,w+=t*ae,v+=t*ce,y+=t*he,_+=t*xe,M+=t*ge,t=o[13],O+=t*c,K+=t*z,P+=t*te,W+=t*ne,C+=t*J,A+=t*Z,j+=t*Q,E+=t*fe,x+=t*ie,g+=t*oe,w+=t*se,v+=t*ae,y+=t*ce,_+=t*he,M+=t*xe,Y+=t*ge,t=o[14],K+=t*c,P+=t*z,W+=t*te,C+=t*ne,A+=t*J,j+=t*Z,E+=t*Q,x+=t*fe,g+=t*ie,w+=t*oe,v+=t*se,y+=t*ae,_+=t*ce,M+=t*he,Y+=t*xe,$+=t*ge,t=o[15],P+=t*c,W+=t*z,C+=t*te,A+=t*ne,j+=t*J,E+=t*Z,x+=t*Q,g+=t*fe,w+=t*ie,v+=t*oe,y+=t*se,_+=t*ae,M+=t*ce,Y+=t*he,$+=t*xe,G+=t*ge,d+=38*W,u+=38*C,b+=38*A,S+=38*j,L+=38*E,U+=38*x,ee+=38*g,R+=38*w,I+=38*v,k+=38*y,D+=38*_,F+=38*M,N+=38*Y,O+=38*$,K+=38*G,s=1,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=u+s+65535,s=Math.floor(t/65536),u=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,t=L+s+65535,s=Math.floor(t/65536),L=t-s*65536,t=U+s+65535,s=Math.floor(t/65536),U=t-s*65536,t=ee+s+65535,s=Math.floor(t/65536),ee=t-s*65536,t=R+s+65535,s=Math.floor(t/65536),R=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=k+s+65535,s=Math.floor(t/65536),k=t-s*65536,t=D+s+65535,s=Math.floor(t/65536),D=t-s*65536,t=F+s+65535,s=Math.floor(t/65536),F=t-s*65536,t=N+s+65535,s=Math.floor(t/65536),N=t-s*65536,t=O+s+65535,s=Math.floor(t/65536),O=t-s*65536,t=K+s+65535,s=Math.floor(t/65536),K=t-s*65536,t=P+s+65535,s=Math.floor(t/65536),P=t-s*65536,d+=s-1+37*(s-1),s=1,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=u+s+65535,s=Math.floor(t/65536),u=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,t=L+s+65535,s=Math.floor(t/65536),L=t-s*65536,t=U+s+65535,s=Math.floor(t/65536),U=t-s*65536,t=ee+s+65535,s=Math.floor(t/65536),ee=t-s*65536,t=R+s+65535,s=Math.floor(t/65536),R=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=k+s+65535,s=Math.floor(t/65536),k=t-s*65536,t=D+s+65535,s=Math.floor(t/65536),D=t-s*65536,t=F+s+65535,s=Math.floor(t/65536),F=t-s*65536,t=N+s+65535,s=Math.floor(t/65536),N=t-s*65536,t=O+s+65535,s=Math.floor(t/65536),O=t-s*65536,t=K+s+65535,s=Math.floor(t/65536),K=t-s*65536,t=P+s+65535,s=Math.floor(t/65536),P=t-s*65536,d+=s-1+37*(s-1),r[0]=d,r[1]=u,r[2]=b,r[3]=S,r[4]=L,r[5]=U,r[6]=ee,r[7]=R,r[8]=I,r[9]=k,r[10]=D,r[11]=F,r[12]=N,r[13]=O,r[14]=K,r[15]=P}function be(r,o){X(r,o,o)}function tn(r,o){var i=n(),t;for(t=0;t<16;t++)i[t]=o[t];for(t=253;t>=0;t--)be(i,i),t!==2&&t!==4&&X(i,i,o);for(t=0;t<16;t++)r[t]=i[t]}function nn(r,o){var i=n(),t;for(t=0;t<16;t++)i[t]=o[t];for(t=250;t>=0;t--)be(i,i),t!==1&&X(i,i,o);for(t=0;t<16;t++)r[t]=i[t]}function et(r,o,i){var t=new Uint8Array(32),s=new Float64Array(80),d,u,b=n(),S=n(),L=n(),U=n(),ee=n(),R=n();for(u=0;u<31;u++)t[u]=o[u];for(t[31]=o[31]&127|64,t[0]&=248,Ct(s,i),u=0;u<16;u++)S[u]=s[u],U[u]=b[u]=L[u]=0;for(b[0]=U[0]=1,u=254;u>=0;--u)d=t[u>>>3]>>>(u&7)&1,Le(b,S,d),Le(L,U,d),we(ee,b,L),me(b,b,L),we(L,S,U),me(S,S,U),be(U,ee),be(R,b),X(b,L,b),X(L,S,ee),we(ee,b,L),me(b,b,L),be(S,b),me(L,U,R),X(b,L,H),we(b,b,U),X(L,L,b),X(b,U,R),X(U,S,s),be(S,ee),Le(b,S,d),Le(L,U,d);for(u=0;u<16;u++)s[u+16]=b[u],s[u+32]=L[u],s[u+48]=S[u],s[u+64]=U[u];var I=s.subarray(32),k=s.subarray(16);return tn(I,I),X(k,k,I),We(r,k),0}function tt(r,o){return et(r,o,h)}function rn(r,o){return f(o,32),tt(r,o)}function nt(r,o,i){var t=new Uint8Array(32);return et(t,i,o),Qe(r,l,t,Pe)}var on=St,Ln=Et;function Wn(r,o,i,t,s,d){var u=new Uint8Array(32);return nt(u,s,d),on(r,o,i,t,u)}function Bn(r,o,i,t,s,d){var u=new Uint8Array(32);return nt(u,s,d),Ln(r,o,i,t,u)}var sn=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function an(r,o,i,t){for(var s=new Int32Array(16),d=new Int32Array(16),u,b,S,L,U,ee,R,I,k,D,F,N,O,K,P,W,C,A,j,E,x,g,w,v,y,_,M=r[0],Y=r[1],$=r[2],G=r[3],c=r[4],z=r[5],te=r[6],ne=r[7],J=o[0],Z=o[1],Q=o[2],fe=o[3],ie=o[4],oe=o[5],se=o[6],ae=o[7],ce=0;t>=128;){for(j=0;j<16;j++)E=8*j+ce,s[j]=i[E+0]<<24|i[E+1]<<16|i[E+2]<<8|i[E+3],d[j]=i[E+4]<<24|i[E+5]<<16|i[E+6]<<8|i[E+7];for(j=0;j<80;j++)if(u=M,b=Y,S=$,L=G,U=c,ee=z,R=te,I=ne,k=J,D=Z,F=Q,N=fe,O=ie,K=oe,P=se,W=ae,x=ne,g=ae,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=(c>>>14|ie<<18)^(c>>>18|ie<<14)^(ie>>>9|c<<23),g=(ie>>>14|c<<18)^(ie>>>18|c<<14)^(c>>>9|ie<<23),w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,x=c&z^~c&te,g=ie&oe^~ie&se,w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,x=sn[j*2],g=sn[j*2+1],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,x=s[j%16],g=d[j%16],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,C=y&65535|_<<16,A=w&65535|v<<16,x=C,g=A,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=(M>>>28|J<<4)^(J>>>2|M<<30)^(J>>>7|M<<25),g=(J>>>28|M<<4)^(M>>>2|J<<30)^(M>>>7|J<<25),w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,x=M&Y^M&$^Y&$,g=J&Z^J&Q^Z&Q,w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,I=y&65535|_<<16,W=w&65535|v<<16,x=L,g=N,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=C,g=A,w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,L=y&65535|_<<16,N=w&65535|v<<16,Y=u,$=b,G=S,c=L,z=U,te=ee,ne=R,M=I,Z=k,Q=D,fe=F,ie=N,oe=O,se=K,ae=P,J=W,j%16===15)for(E=0;E<16;E++)x=s[E],g=d[E],w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=s[(E+9)%16],g=d[(E+9)%16],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,C=s[(E+1)%16],A=d[(E+1)%16],x=(C>>>1|A<<31)^(C>>>8|A<<24)^C>>>7,g=(A>>>1|C<<31)^(A>>>8|C<<24)^(A>>>7|C<<25),w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,C=s[(E+14)%16],A=d[(E+14)%16],x=(C>>>19|A<<13)^(A>>>29|C<<3)^C>>>6,g=(A>>>19|C<<13)^(C>>>29|A<<3)^(A>>>6|C<<26),w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,s[E]=y&65535|_<<16,d[E]=w&65535|v<<16;x=M,g=J,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[0],g=o[0],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[0]=M=y&65535|_<<16,o[0]=J=w&65535|v<<16,x=Y,g=Z,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[1],g=o[1],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[1]=Y=y&65535|_<<16,o[1]=Z=w&65535|v<<16,x=$,g=Q,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[2],g=o[2],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[2]=$=y&65535|_<<16,o[2]=Q=w&65535|v<<16,x=G,g=fe,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[3],g=o[3],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[3]=G=y&65535|_<<16,o[3]=fe=w&65535|v<<16,x=c,g=ie,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[4],g=o[4],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[4]=c=y&65535|_<<16,o[4]=ie=w&65535|v<<16,x=z,g=oe,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[5],g=o[5],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[5]=z=y&65535|_<<16,o[5]=oe=w&65535|v<<16,x=te,g=se,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[6],g=o[6],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[6]=te=y&65535|_<<16,o[6]=se=w&65535|v<<16,x=ne,g=ae,w=g&65535,v=g>>>16,y=x&65535,_=x>>>16,x=r[7],g=o[7],w+=g&65535,v+=g>>>16,y+=x&65535,_+=x>>>16,v+=w>>>16,y+=v>>>16,_+=y>>>16,r[7]=ne=y&65535|_<<16,o[7]=ae=w&65535|v<<16,ce+=128,t-=128}return t}function Ae(r,o,i){var t=new Int32Array(8),s=new Int32Array(8),d=new Uint8Array(256),u,b=i;for(t[0]=1779033703,t[1]=3144134277,t[2]=1013904242,t[3]=2773480762,t[4]=1359893119,t[5]=2600822924,t[6]=528734635,t[7]=1541459225,s[0]=4089235720,s[1]=2227873595,s[2]=4271175723,s[3]=1595750129,s[4]=2917565137,s[5]=725511199,s[6]=4215389547,s[7]=327033209,an(t,s,o,i),i%=128,u=0;u<i;u++)d[u]=o[b-i+u];for(d[i]=128,i=256-128*(i<112?1:0),d[i-9]=0,ue(d,i-8,b/536870912|0,b<<3),an(t,s,d,i),u=0;u<8;u++)ue(r,8*u,t[u],s[u]);return 0}function rt(r,o){var i=n(),t=n(),s=n(),d=n(),u=n(),b=n(),S=n(),L=n(),U=n();me(i,r[1],r[0]),me(U,o[1],o[0]),X(i,i,U),we(t,r[0],r[1]),we(U,o[0],o[1]),X(t,t,U),X(s,r[3],o[3]),X(s,s,re),X(d,r[2],o[2]),we(d,d,d),me(u,t,i),me(b,d,s),we(S,d,s),we(L,t,i),X(r[0],u,b),X(r[1],L,S),X(r[2],S,b),X(r[3],u,L)}function fn(r,o,i){var t;for(t=0;t<4;t++)Le(r[t],o[t],i)}function Tt(r,o){var i=n(),t=n(),s=n();tn(s,o[2]),X(i,o[0],s),X(t,o[1],s),We(r,t),r[31]^=en(i)<<7}function Rt(r,o,i){var t,s;for(Se(r[0],p),Se(r[1],m),Se(r[2],m),Se(r[3],p),s=255;s>=0;--s)t=i[s/8|0]>>(s&7)&1,fn(r,o,t),rt(o,r),rt(r,r),fn(r,o,t)}function it(r,o){var i=[n(),n(),n(),n()];Se(i[0],V),Se(i[1],de),Se(i[2],m),X(i[3],V,de),Rt(r,i,o)}function Pt(r,o,i){var t=new Uint8Array(64),s=[n(),n(),n(),n()],d;for(i||f(o,32),Ae(t,o,32),t[0]&=248,t[31]&=127,t[31]|=64,it(s,t),Tt(r,s),d=0;d<32;d++)o[d+32]=r[d];return 0}var ot=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function At(r,o){var i,t,s,d;for(t=63;t>=32;--t){for(i=0,s=t-32,d=t-12;s<d;++s)o[s]+=i-16*o[t]*ot[s-(t-32)],i=Math.floor((o[s]+128)/256),o[s]-=i*256;o[s]+=i,o[t]=0}for(i=0,s=0;s<32;s++)o[s]+=i-(o[31]>>4)*ot[s],i=o[s]>>8,o[s]&=255;for(s=0;s<32;s++)o[s]-=i*ot[s];for(t=0;t<32;t++)o[t+1]+=o[t]>>8,r[t]=o[t]&255}function jt(r){var o=new Float64Array(64),i;for(i=0;i<64;i++)o[i]=r[i];for(i=0;i<64;i++)r[i]=0;At(r,o)}function cn(r,o,i,t){var s=new Uint8Array(64),d=new Uint8Array(64),u=new Uint8Array(64),b,S,L=new Float64Array(64),U=[n(),n(),n(),n()];Ae(s,t,32),s[0]&=248,s[31]&=127,s[31]|=64;var ee=i+64;for(b=0;b<i;b++)r[64+b]=o[b];for(b=0;b<32;b++)r[32+b]=s[32+b];for(Ae(u,r.subarray(32),i+32),jt(u),it(U,u),Tt(r,U),b=32;b<64;b++)r[b]=t[b];for(Ae(d,r,i+64),jt(d),b=0;b<64;b++)L[b]=0;for(b=0;b<32;b++)L[b]=u[b];for(b=0;b<32;b++)for(S=0;S<32;S++)L[b+S]+=d[b]*s[S];return At(r.subarray(32),L),ee}function Mn(r,o){var i=n(),t=n(),s=n(),d=n(),u=n(),b=n(),S=n();return Se(r[2],m),Ct(r[1],o),be(s,r[1]),X(d,s,q),me(s,s,r[2]),we(d,r[2],d),be(u,d),be(b,u),X(S,b,u),X(i,S,s),X(i,i,d),nn(i,i),X(i,i,s),X(i,i,d),X(i,i,d),X(r[0],i,d),be(t,r[0]),X(t,t,d),Vt(t,s)&&X(r[0],r[0],ye),be(t,r[0]),X(t,t,d),Vt(t,s)?-1:(en(r[0])===o[31]>>7&&me(r[0],p,r[0]),X(r[3],r[0],r[1]),0)}function Lt(r,o,i,t){var s,d=new Uint8Array(32),u=new Uint8Array(64),b=[n(),n(),n(),n()],S=[n(),n(),n(),n()];if(i<64||Mn(S,t))return-1;for(s=0;s<i;s++)r[s]=o[s];for(s=0;s<32;s++)r[s+32]=t[s];if(Ae(u,r,i),jt(u),Rt(b,S,u),it(S,o.subarray(32)),rt(b,S),Tt(d,b),i-=64,wt(o,0,d,0)){for(s=0;s<i;s++)r[s]=0;return-1}for(s=0;s<i;s++)r[s]=o[s+64];return i}var Wt=32,st=24,Oe=32,Be=16,Fe=32,at=32,qe=32,De=32,Bt=32,ln=st,In=Oe,kn=Be,Ee=64,je=32,Me=64,Mt=32,It=64;e.lowlevel={crypto_core_hsalsa20:Qe,crypto_stream_xor:mt,crypto_stream:Zt,crypto_stream_salsa20_xor:zt,crypto_stream_salsa20:Xt,crypto_onetimeauth:_t,crypto_onetimeauth_verify:Qt,crypto_verify_16:Xe,crypto_verify_32:wt,crypto_secretbox:St,crypto_secretbox_open:Et,crypto_scalarmult:et,crypto_scalarmult_base:tt,crypto_box_beforenm:nt,crypto_box_afternm:on,crypto_box:Wn,crypto_box_open:Bn,crypto_box_keypair:rn,crypto_hash:Ae,crypto_sign:cn,crypto_sign_keypair:Pt,crypto_sign_open:Lt,crypto_secretbox_KEYBYTES:Wt,crypto_secretbox_NONCEBYTES:st,crypto_secretbox_ZEROBYTES:Oe,crypto_secretbox_BOXZEROBYTES:Be,crypto_scalarmult_BYTES:Fe,crypto_scalarmult_SCALARBYTES:at,crypto_box_PUBLICKEYBYTES:qe,crypto_box_SECRETKEYBYTES:De,crypto_box_BEFORENMBYTES:Bt,crypto_box_NONCEBYTES:ln,crypto_box_ZEROBYTES:In,crypto_box_BOXZEROBYTES:kn,crypto_sign_BYTES:Ee,crypto_sign_PUBLICKEYBYTES:je,crypto_sign_SECRETKEYBYTES:Me,crypto_sign_SEEDBYTES:Mt,crypto_hash_BYTES:It,gf:n,D:q,L:ot,pack25519:We,unpack25519:Ct,M:X,A:we,S:be,Z:me,pow2523:nn,add:rt,set25519:Se,modL:At,scalarmult:Rt,scalarbase:it};function dn(r,o){if(r.length!==Wt)throw new Error("bad key size");if(o.length!==st)throw new Error("bad nonce size")}function Nn(r,o){if(r.length!==qe)throw new Error("bad public key size");if(o.length!==De)throw new Error("bad secret key size")}function ve(){for(var r=0;r<arguments.length;r++)if(!(arguments[r]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function un(r){for(var o=0;o<r.length;o++)r[o]=0}e.randomBytes=function(r){var o=new Uint8Array(r);return f(o,r),o},e.secretbox=function(r,o,i){ve(r,o,i),dn(i,o);for(var t=new Uint8Array(Oe+r.length),s=new Uint8Array(t.length),d=0;d<r.length;d++)t[d+Oe]=r[d];return St(s,t,t.length,o,i),s.subarray(Be)},e.secretbox.open=function(r,o,i){ve(r,o,i),dn(i,o);for(var t=new Uint8Array(Be+r.length),s=new Uint8Array(t.length),d=0;d<r.length;d++)t[d+Be]=r[d];return t.length<32||Et(s,t,t.length,o,i)!==0?null:s.subarray(Oe)},e.secretbox.keyLength=Wt,e.secretbox.nonceLength=st,e.secretbox.overheadLength=Be,e.scalarMult=function(r,o){if(ve(r,o),r.length!==at)throw new Error("bad n size");if(o.length!==Fe)throw new Error("bad p size");var i=new Uint8Array(Fe);return et(i,r,o),i},e.scalarMult.base=function(r){if(ve(r),r.length!==at)throw new Error("bad n size");var o=new Uint8Array(Fe);return tt(o,r),o},e.scalarMult.scalarLength=at,e.scalarMult.groupElementLength=Fe,e.box=function(r,o,i,t){var s=e.box.before(i,t);return e.secretbox(r,o,s)},e.box.before=function(r,o){ve(r,o),Nn(r,o);var i=new Uint8Array(Bt);return nt(i,r,o),i},e.box.after=e.secretbox,e.box.open=function(r,o,i,t){var s=e.box.before(i,t);return e.secretbox.open(r,o,s)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var r=new Uint8Array(qe),o=new Uint8Array(De);return rn(r,o),{publicKey:r,secretKey:o}},e.box.keyPair.fromSecretKey=function(r){if(ve(r),r.length!==De)throw new Error("bad secret key size");var o=new Uint8Array(qe);return tt(o,r),{publicKey:o,secretKey:new Uint8Array(r)}},e.box.publicKeyLength=qe,e.box.secretKeyLength=De,e.box.sharedKeyLength=Bt,e.box.nonceLength=ln,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(r,o){if(ve(r,o),o.length!==Me)throw new Error("bad secret key size");var i=new Uint8Array(Ee+r.length);return cn(i,r,r.length,o),i},e.sign.open=function(r,o){if(ve(r,o),o.length!==je)throw new Error("bad public key size");var i=new Uint8Array(r.length),t=Lt(i,r,r.length,o);if(t<0)return null;for(var s=new Uint8Array(t),d=0;d<s.length;d++)s[d]=i[d];return s},e.sign.detached=function(r,o){for(var i=e.sign(r,o),t=new Uint8Array(Ee),s=0;s<t.length;s++)t[s]=i[s];return t},e.sign.detached.verify=function(r,o,i){if(ve(r,o,i),o.length!==Ee)throw new Error("bad signature size");if(i.length!==je)throw new Error("bad public key size");var t=new Uint8Array(Ee+r.length),s=new Uint8Array(Ee+r.length),d;for(d=0;d<Ee;d++)t[d]=o[d];for(d=0;d<r.length;d++)t[d+Ee]=r[d];return Lt(s,t,t.length,i)>=0},e.sign.keyPair=function(){var r=new Uint8Array(je),o=new Uint8Array(Me);return Pt(r,o),{publicKey:r,secretKey:o}},e.sign.keyPair.fromSecretKey=function(r){if(ve(r),r.length!==Me)throw new Error("bad secret key size");for(var o=new Uint8Array(je),i=0;i<o.length;i++)o[i]=r[32+i];return{publicKey:o,secretKey:new Uint8Array(r)}},e.sign.keyPair.fromSeed=function(r){if(ve(r),r.length!==Mt)throw new Error("bad seed size");for(var o=new Uint8Array(je),i=new Uint8Array(Me),t=0;t<32;t++)i[t]=r[t];return Pt(o,i,!0),{publicKey:o,secretKey:i}},e.sign.publicKeyLength=je,e.sign.secretKeyLength=Me,e.sign.seedLength=Mt,e.sign.signatureLength=Ee,e.hash=function(r){ve(r);var o=new Uint8Array(It);return Ae(o,r,r.length),o},e.hash.hashLength=It,e.verify=function(r,o){return ve(r,o),r.length===0||o.length===0||r.length!==o.length?!1:Re(r,0,o,0,r.length)===0},e.setPRNG=function(r){f=r},function(){var r=typeof self<"u"?self.crypto||self.msCrypto:null;if(r&&r.getRandomValues){var o=65536;e.setPRNG(function(i,t){var s,d=new Uint8Array(t);for(s=0;s<t;s+=o)r.getRandomValues(d.subarray(s,s+Math.min(t-s,o)));for(s=0;s<t;s++)i[s]=d[s];un(d)})}else typeof Dn<"u"&&(r=$n,r&&r.randomBytes&&e.setPRNG(function(i,t){var s,d=r.randomBytes(t);for(s=0;s<t;s++)i[s]=d[s];un(d)}))}()})(a.exports?a.exports:self.nacl=self.nacl||{})}(kt)),kt.exports}var Jn=Hn();const ft=Sn(Jn);var Ce;(function(a){a[a.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",a[a.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",a[a.MANIFEST_NOT_FOUND_ERROR=2]="MANIFEST_NOT_FOUND_ERROR",a[a.MANIFEST_CONTENT_ERROR=3]="MANIFEST_CONTENT_ERROR",a[a.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",a[a.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",a[a.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(Ce||(Ce={}));var gn;(function(a){a[a.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",a[a.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(gn||(gn={}));var Ie;(function(a){a[a.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",a[a.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",a[a.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",a[a.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",a[a.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(Ie||(Ie={}));var pn;(function(a){a[a.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",a[a.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",a[a.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",a[a.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",a[a.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(pn||(pn={}));var vn;(function(a){a[a.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",a[a.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",a[a.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",a[a.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(vn||(vn={}));var bn;(function(a){a.MAINNET="-239",a.TESTNET="-3"})(bn||(bn={}));function zn(a,e){const n=He.encodeBase64(a);return e?encodeURIComponent(n):n}function Xn(a,e){return e&&(a=decodeURIComponent(a)),He.decodeBase64(a)}function Zn(a,e=!1){let n;return a instanceof Uint8Array?n=a:(typeof a!="string"&&(a=JSON.stringify(a)),n=He.decodeUTF8(a)),zn(n,e)}function Qn(a,e=!1){const n=Xn(a,e);return{toString(){return He.encodeUTF8(n)},toObject(){try{return JSON.parse(He.encodeUTF8(n))}catch{return null}},toUint8Array(){return n}}}const En={encode:Zn,decode:Qn};function Vn(a,e){const n=new Uint8Array(a.length+e.length);return n.set(a),n.set(e,a.length),n}function er(a,e){if(e>=a.length)throw new Error("Index is out of buffer");const n=a.slice(0,e),f=a.slice(e);return[n,f]}function Nt(a){let e="";return a.forEach(n=>{e+=("0"+(n&255).toString(16)).slice(-2)}),e}function dt(a){if(a.length%2!==0)throw new Error(`Cannot convert ${a} to bytesArray`);const e=new Uint8Array(a.length/2);for(let n=0;n<a.length;n+=2)e[n/2]=parseInt(a.slice(n,n+2),16);return e}class Ft{constructor(e){this.nonceLength=24,this.keyPair=e?this.createKeypairFromString(e):this.createKeypair(),this.sessionId=Nt(this.keyPair.publicKey)}createKeypair(){return ft.box.keyPair()}createKeypairFromString(e){return{publicKey:dt(e.publicKey),secretKey:dt(e.secretKey)}}createNonce(){return ft.randomBytes(this.nonceLength)}encrypt(e,n){const f=new TextEncoder().encode(e),l=this.createNonce(),h=ft.box(f,l,n,this.keyPair.secretKey);return Vn(l,h)}decrypt(e,n){const[f,l]=er(e,this.nonceLength),h=ft.box.open(l,f,n,this.keyPair.secretKey);if(!h)throw new Error(`Decryption error: 
 message: ${e.toString()} 
 sender pubkey: ${n.toString()} 
 keypair pubkey: ${this.keyPair.publicKey.toString()} 
 keypair secretkey: ${this.keyPair.secretKey.toString()}`);return new TextDecoder().decode(h)}stringifyKeypair(){return{publicKey:Nt(this.keyPair.publicKey),secretKey:Nt(this.keyPair.secretKey)}}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function yn(a,e){var n={};for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&e.indexOf(f)<0&&(n[f]=a[f]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,f=Object.getOwnPropertySymbols(a);l<f.length;l++)e.indexOf(f[l])<0&&Object.prototype.propertyIsEnumerable.call(a,f[l])&&(n[f[l]]=a[f[l]]);return n}function T(a,e,n,f){function l(h){return h instanceof n?h:new n(function(p){p(h)})}return new(n||(n=Promise))(function(h,p){function m(re){try{q(f.next(re))}catch(V){p(V)}}function H(re){try{q(f.throw(re))}catch(V){p(V)}}function q(re){re.done?h(re.value):l(re.value).then(m,H)}q((f=f.apply(a,[])).next())})}class B extends Error{constructor(e,n){super(e,n),this.message=`${B.prefix} ${this.constructor.name}${this.info?": "+this.info:""}${e?`
`+e:""}`,Object.setPrototypeOf(this,B.prototype)}get info(){return""}}B.prefix="[TON_CONNECT_SDK_ERROR]";class Dt extends B{get info(){return"Passed DappMetadata is in incorrect format."}constructor(...e){super(...e),Object.setPrototypeOf(this,Dt.prototype)}}class ht extends B{get info(){return"Passed `tonconnect-manifest.json` contains errors. Check format of your manifest. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,ht.prototype)}}class xt extends B{get info(){return"Manifest not found. Make sure you added `tonconnect-manifest.json` to the root of your app or passed correct manifestUrl. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,xt.prototype)}}class Yt extends B{get info(){return"Wallet connection called but wallet already connected. To avoid the error, disconnect the wallet before doing a new connection."}constructor(...e){super(...e),Object.setPrototypeOf(this,Yt.prototype)}}class ut extends B{get info(){return"Send transaction or other protocol methods called while wallet is not connected."}constructor(...e){super(...e),Object.setPrototypeOf(this,ut.prototype)}}class Gt extends B{get info(){return"There is an attempt to connect to the injected wallet while it is not exists in the webpage."}constructor(...e){super(...e),Object.setPrototypeOf(this,Gt.prototype)}}class Ye extends B{get info(){return"Wallet doesn't support requested feature method."}constructor(...e){super(...e),Object.setPrototypeOf(this,Ye.prototype)}}class $t extends B{get info(){return"Missing required features. You need to update your wallet."}constructor(e,n){super(e,n),Object.setPrototypeOf(this,$t.prototype)}}function tr(a){return"jsBridgeKey"in a}class gt extends B{get info(){return"User rejects the action in the wallet."}constructor(...e){super(...e),Object.setPrototypeOf(this,gt.prototype)}}class pt extends B{get info(){return"Request to the wallet contains errors."}constructor(...e){super(...e),Object.setPrototypeOf(this,pt.prototype)}}class vt extends B{get info(){return"App tries to send rpc request to the injected wallet while not connected."}constructor(...e){super(...e),Object.setPrototypeOf(this,vt.prototype)}}class Ht extends B{get info(){return"An error occurred while fetching the wallets list."}constructor(...e){super(...e),Object.setPrototypeOf(this,Ht.prototype)}}class Te extends B{constructor(...e){super(...e),Object.setPrototypeOf(this,Te.prototype)}}const wn={[Ce.UNKNOWN_ERROR]:Te,[Ce.USER_REJECTS_ERROR]:gt,[Ce.BAD_REQUEST_ERROR]:pt,[Ce.UNKNOWN_APP_ERROR]:vt,[Ce.MANIFEST_NOT_FOUND_ERROR]:xt,[Ce.MANIFEST_CONTENT_ERROR]:ht};class nr{parseError(e){let n=Te;return e.code in wn&&(n=wn[e.code]||Te),new n(e.message)}}const rr=new nr;class ir{isError(e){return"error"in e}}const mn={[Ie.UNKNOWN_ERROR]:Te,[Ie.USER_REJECTS_ERROR]:gt,[Ie.BAD_REQUEST_ERROR]:pt,[Ie.UNKNOWN_APP_ERROR]:vt};class or extends ir{convertToRpcRequest(e){return{method:"sendTransaction",params:[JSON.stringify(e)]}}parseAndThrowError(e){let n=Te;throw e.error.code in mn&&(n=mn[e.error.code]||Te),new n(e.error.message)}convertFromRpcResponse(e){return{boc:e.result}}}const ct=new or;class sr{constructor(e,n){this.storage=e,this.storeKey="ton-connect-storage_http-bridge-gateway::"+n}storeLastEventId(e){return T(this,void 0,void 0,function*(){return this.storage.setItem(this.storeKey,e)})}removeLastEventId(){return T(this,void 0,void 0,function*(){return this.storage.removeItem(this.storeKey)})}getLastEventId(){return T(this,void 0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);return e||null})}}function ar(a){return a.slice(-1)==="/"?a.slice(0,-1):a}function Un(a,e){return ar(a)+"/"+e}function fr(a){if(!a)return!1;const e=new URL(a);return e.protocol==="tg:"||e.hostname==="t.me"}function cr(a){return a.replaceAll(".","%2E").replaceAll("-","%2D").replaceAll("_","%5F").replaceAll("&","-").replaceAll("=","__").replaceAll("%","--")}function Cn(a,e){return T(this,void 0,void 0,function*(){return new Promise((n,f)=>{var l,h;if(!((l=void 0)===null||l===void 0)&&l.aborted){f(new B("Delay aborted"));return}const p=setTimeout(()=>n(),a);(h=void 0)===null||h===void 0||h.addEventListener("abort",()=>{clearTimeout(p),f(new B("Delay aborted"))})})})}function _e(a){const e=new AbortController;return a!=null&&a.aborted?e.abort():a==null||a.addEventListener("abort",()=>e.abort(),{once:!0}),e}function Ge(a,e){var n,f;return T(this,void 0,void 0,function*(){const l=(n=e==null?void 0:e.attempts)!==null&&n!==void 0?n:10,h=(f=e==null?void 0:e.delayMs)!==null&&f!==void 0?f:200,p=_e(e==null?void 0:e.signal);if(typeof a!="function")throw new B(`Expected a function, got ${typeof a}`);let m=0,H;for(;m<l;){if(p.signal.aborted)throw new B(`Aborted after attempts ${m}`);try{return yield a({signal:p.signal})}catch(q){H=q,m++,m<l&&(yield Cn(h))}}throw H})}function le(...a){try{console.debug("[TON_CONNECT_SDK]",...a)}catch{}}function Ue(...a){try{console.error("[TON_CONNECT_SDK]",...a)}catch{}}function lr(...a){try{console.warn("[TON_CONNECT_SDK]",...a)}catch{}}function dr(a,e){let n=null,f=null,l=null,h=null,p=null;const m=(V,...de)=>T(this,void 0,void 0,function*(){if(h=V??null,p==null||p.abort(),p=_e(V),p.signal.aborted)throw new B("Resource creation was aborted");f=de??null;const ye=a(p.signal,...de);l=ye;const ue=yield ye;if(l!==ye&&ue!==n)throw yield e(ue),new B("Resource creation was aborted by a new resource creation");return n=ue,n});return{create:m,current:()=>n??null,dispose:()=>T(this,void 0,void 0,function*(){try{const V=n;n=null;const de=l;l=null;try{p==null||p.abort()}catch{}yield Promise.allSettled([V?e(V):Promise.resolve(),de?e(yield de):Promise.resolve()])}catch{}}),recreate:V=>T(this,void 0,void 0,function*(){const de=n,ye=l,ue=f,Re=h;if(yield Cn(V),de===n&&ye===l&&ue===f&&Re===h)return yield m(h,...ue??[]);throw new B("Resource recreation was aborted by a new resource creation")})}}function ur(a,e){const n=e==null?void 0:e.timeout,f=e==null?void 0:e.signal,l=_e(f);return new Promise((h,p)=>T(this,void 0,void 0,function*(){if(l.signal.aborted){p(new B("Operation aborted"));return}let m;typeof n<"u"&&(m=setTimeout(()=>{l.abort(),p(new B(`Timeout after ${n}ms`))},n)),l.signal.addEventListener("abort",()=>{clearTimeout(m),p(new B("Operation aborted"))},{once:!0});const H={timeout:n,abort:l.signal};yield a((...q)=>{clearTimeout(m),h(...q)},()=>{clearTimeout(m),p()},H)}))}class Kt{constructor(e,n,f,l,h){this.bridgeUrl=n,this.sessionId=f,this.listener=l,this.errorsListener=h,this.ssePath="events",this.postPath="message",this.heartbeatMessage="heartbeat",this.defaultTtl=300,this.defaultReconnectDelay=2e3,this.defaultResendDelay=5e3,this.eventSource=dr((p,m)=>T(this,void 0,void 0,function*(){const H={bridgeUrl:this.bridgeUrl,ssePath:this.ssePath,sessionId:this.sessionId,bridgeGatewayStorage:this.bridgeGatewayStorage,errorHandler:this.errorsHandler.bind(this),messageHandler:this.messagesHandler.bind(this),signal:p,openingDeadlineMS:m};return yield hr(H)}),p=>T(this,void 0,void 0,function*(){p.close()})),this.bridgeGatewayStorage=new sr(e,n)}get isReady(){const e=this.eventSource.current();return(e==null?void 0:e.readyState)===EventSource.OPEN}get isClosed(){const e=this.eventSource.current();return(e==null?void 0:e.readyState)!==EventSource.OPEN}get isConnecting(){const e=this.eventSource.current();return(e==null?void 0:e.readyState)===EventSource.CONNECTING}registerSession(e){return T(this,void 0,void 0,function*(){yield this.eventSource.create(e==null?void 0:e.signal,e==null?void 0:e.openingDeadlineMS)})}send(e,n,f,l){var h;return T(this,void 0,void 0,function*(){const p={};typeof l=="number"?p.ttl=l:(p.ttl=l==null?void 0:l.ttl,p.signal=l==null?void 0:l.signal,p.attempts=l==null?void 0:l.attempts);const m=new URL(Un(this.bridgeUrl,this.postPath));m.searchParams.append("client_id",this.sessionId),m.searchParams.append("to",n),m.searchParams.append("ttl",((p==null?void 0:p.ttl)||this.defaultTtl).toString()),m.searchParams.append("topic",f);const H=En.encode(e);yield Ge(q=>T(this,void 0,void 0,function*(){const re=yield this.post(m,H,q.signal);if(!re.ok)throw new B(`Bridge send failed, status ${re.status}`)}),{attempts:(h=p==null?void 0:p.attempts)!==null&&h!==void 0?h:Number.MAX_SAFE_INTEGER,delayMs:this.defaultResendDelay,signal:p==null?void 0:p.signal})})}pause(){this.eventSource.dispose().catch(e=>Ue(`Bridge pause failed, ${e}`))}unPause(){return T(this,void 0,void 0,function*(){yield this.eventSource.recreate(0)})}close(){return T(this,void 0,void 0,function*(){yield this.eventSource.dispose().catch(e=>Ue(`Bridge close failed, ${e}`))})}setListener(e){this.listener=e}setErrorsListener(e){this.errorsListener=e}post(e,n,f){return T(this,void 0,void 0,function*(){const l=yield fetch(e,{method:"post",body:n,signal:f});if(!l.ok)throw new B(`Bridge send failed, status ${l.status}`);return l})}errorsHandler(e,n){return T(this,void 0,void 0,function*(){if(this.isConnecting)throw e.close(),new B("Bridge error, failed to connect");if(this.isReady){try{this.errorsListener(n)}catch{}return}if(this.isClosed)return e.close(),le(`Bridge reconnecting, ${this.defaultReconnectDelay}ms delay`),yield this.eventSource.recreate(this.defaultReconnectDelay);throw new B("Bridge error, unknown state")})}messagesHandler(e){return T(this,void 0,void 0,function*(){if(e.data===this.heartbeatMessage||(yield this.bridgeGatewayStorage.storeLastEventId(e.lastEventId),this.isClosed))return;let n;try{n=JSON.parse(e.data)}catch(f){throw new B(`Bridge message parse failed, message ${f.data}`)}this.listener(n)})}}function hr(a){return T(this,void 0,void 0,function*(){return yield ur((e,n,f)=>T(this,void 0,void 0,function*(){var l;const p=_e(f.signal).signal;if(p.aborted){n(new B("Bridge connection aborted"));return}const m=new URL(Un(a.bridgeUrl,a.ssePath));m.searchParams.append("client_id",a.sessionId);const H=yield a.bridgeGatewayStorage.getLastEventId();if(H&&m.searchParams.append("last_event_id",H),p.aborted){n(new B("Bridge connection aborted"));return}const q=new EventSource(m.toString());q.onerror=re=>T(this,void 0,void 0,function*(){if(p.aborted){q.close(),n(new B("Bridge connection aborted"));return}try{const V=yield a.errorHandler(q,re);V!==q&&q.close(),V&&V!==q&&e(V)}catch(V){q.close(),n(V)}}),q.onopen=()=>{if(p.aborted){q.close(),n(new B("Bridge connection aborted"));return}e(q)},q.onmessage=re=>{if(p.aborted){q.close(),n(new B("Bridge connection aborted"));return}a.messageHandler(re)},(l=a.signal)===null||l===void 0||l.addEventListener("abort",()=>{q.close(),n(new B("Bridge connection aborted"))})}),{timeout:a.openingDeadlineMS,signal:a.signal})})}function $e(a){return!("connectEvent"in a)}class Je{constructor(e){this.storage=e,this.storeKey="ton-connect-storage_bridge-connection"}storeConnection(e){return T(this,void 0,void 0,function*(){if(e.type==="injected")return this.storage.setItem(this.storeKey,JSON.stringify(e));if(!$e(e)){const f={sessionKeyPair:e.session.sessionCrypto.stringifyKeypair(),walletPublicKey:e.session.walletPublicKey,bridgeUrl:e.session.bridgeUrl},l={type:"http",connectEvent:e.connectEvent,session:f,lastWalletEventId:e.lastWalletEventId,nextRpcRequestId:e.nextRpcRequestId};return this.storage.setItem(this.storeKey,JSON.stringify(l))}const n={type:"http",connectionSource:e.connectionSource,sessionCrypto:e.sessionCrypto.stringifyKeypair()};return this.storage.setItem(this.storeKey,JSON.stringify(n))})}removeConnection(){return T(this,void 0,void 0,function*(){return this.storage.removeItem(this.storeKey)})}getConnection(){return T(this,void 0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);if(!e)return null;const n=JSON.parse(e);if(n.type==="injected")return n;if("connectEvent"in n){const f=new Ft(n.session.sessionKeyPair);return{type:"http",connectEvent:n.connectEvent,lastWalletEventId:n.lastWalletEventId,nextRpcRequestId:n.nextRpcRequestId,session:{sessionCrypto:f,bridgeUrl:n.session.bridgeUrl,walletPublicKey:n.session.walletPublicKey}}}return{type:"http",sessionCrypto:new Ft(n.sessionCrypto),connectionSource:n.connectionSource}})}getHttpConnection(){return T(this,void 0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new B("Trying to read HTTP connection source while nothing is stored");if(e.type==="injected")throw new B("Trying to read HTTP connection source while injected connection is stored");return e})}getHttpPendingConnection(){return T(this,void 0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new B("Trying to read HTTP connection source while nothing is stored");if(e.type==="injected")throw new B("Trying to read HTTP connection source while injected connection is stored");if(!$e(e))throw new B("Trying to read HTTP-pending connection while http connection is stored");return e})}getInjectedConnection(){return T(this,void 0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new B("Trying to read Injected bridge connection source while nothing is stored");if((e==null?void 0:e.type)==="http")throw new B("Trying to read Injected bridge connection source while HTTP connection is stored");return e})}storedConnectionType(){return T(this,void 0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);return e?JSON.parse(e).type:null})}storeLastWalletEventId(e){return T(this,void 0,void 0,function*(){const n=yield this.getConnection();if(n&&n.type==="http"&&!$e(n))return n.lastWalletEventId=e,this.storeConnection(n)})}getLastWalletEventId(){return T(this,void 0,void 0,function*(){const e=yield this.getConnection();if(e&&"lastWalletEventId"in e)return e.lastWalletEventId})}increaseNextRpcRequestId(){return T(this,void 0,void 0,function*(){const e=yield this.getConnection();if(e&&"nextRpcRequestId"in e){const n=e.nextRpcRequestId||0;return e.nextRpcRequestId=n+1,this.storeConnection(e)}})}getNextRpcRequestId(){return T(this,void 0,void 0,function*(){const e=yield this.getConnection();return e&&"nextRpcRequestId"in e&&e.nextRpcRequestId||0})}}const Tn=2;class ze{constructor(e,n){this.storage=e,this.walletConnectionSource=n,this.type="http",this.standardUniversalLink="tc://",this.pendingRequests=new Map,this.session=null,this.gateway=null,this.pendingGateways=[],this.listeners=[],this.defaultOpeningDeadlineMS=12e3,this.defaultRetryTimeoutMS=2e3,this.connectionStorage=new Je(e)}static fromStorage(e){return T(this,void 0,void 0,function*(){const f=yield new Je(e).getHttpConnection();return $e(f)?new ze(e,f.connectionSource):new ze(e,{bridgeUrl:f.session.bridgeUrl})})}connect(e,n){var f;const l=_e(n==null?void 0:n.signal);(f=this.abortController)===null||f===void 0||f.abort(),this.abortController=l,this.closeGateways();const h=new Ft;this.session={sessionCrypto:h,bridgeUrl:"bridgeUrl"in this.walletConnectionSource?this.walletConnectionSource.bridgeUrl:""},this.connectionStorage.storeConnection({type:"http",connectionSource:this.walletConnectionSource,sessionCrypto:h}).then(()=>T(this,void 0,void 0,function*(){l.signal.aborted||(yield Ge(m=>{var H;return this.openGateways(h,{openingDeadlineMS:(H=n==null?void 0:n.openingDeadlineMS)!==null&&H!==void 0?H:this.defaultOpeningDeadlineMS,signal:m==null?void 0:m.signal})},{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:l.signal}))}));const p="universalLink"in this.walletConnectionSource&&this.walletConnectionSource.universalLink?this.walletConnectionSource.universalLink:this.standardUniversalLink;return this.generateUniversalLink(p,e)}restoreConnection(e){var n,f;return T(this,void 0,void 0,function*(){const l=_e(e==null?void 0:e.signal);if((n=this.abortController)===null||n===void 0||n.abort(),this.abortController=l,l.signal.aborted)return;this.closeGateways();const h=yield this.connectionStorage.getHttpConnection();if(!h||l.signal.aborted)return;const p=(f=e==null?void 0:e.openingDeadlineMS)!==null&&f!==void 0?f:this.defaultOpeningDeadlineMS;if($e(h))return this.session={sessionCrypto:h.sessionCrypto,bridgeUrl:"bridgeUrl"in this.walletConnectionSource?this.walletConnectionSource.bridgeUrl:""},yield this.openGateways(h.sessionCrypto,{openingDeadlineMS:p,signal:l==null?void 0:l.signal});if(Array.isArray(this.walletConnectionSource))throw new B("Internal error. Connection source is array while WalletConnectionSourceHTTP was expected.");if(this.session=h.session,this.gateway&&(le("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.gateway=new Kt(this.storage,this.walletConnectionSource.bridgeUrl,h.session.sessionCrypto.sessionId,this.gatewayListener.bind(this),this.gatewayErrorsListener.bind(this)),!l.signal.aborted){this.listeners.forEach(m=>m(h.connectEvent));try{yield Ge(m=>this.gateway.registerSession({openingDeadlineMS:p,signal:m.signal}),{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:l.signal})}catch{yield this.disconnect({signal:l.signal});return}}})}sendRequest(e,n){const f={};return typeof n=="function"?f.onRequestSent=n:(f.onRequestSent=n==null?void 0:n.onRequestSent,f.signal=n==null?void 0:n.signal,f.attempts=n==null?void 0:n.attempts),new Promise((l,h)=>T(this,void 0,void 0,function*(){var p;if(!this.gateway||!this.session||!("walletPublicKey"in this.session))throw new B("Trying to send bridge request without session");const m=(yield this.connectionStorage.getNextRpcRequestId()).toString();yield this.connectionStorage.increaseNextRpcRequestId(),le("Send http-bridge request:",Object.assign(Object.assign({},e),{id:m}));const H=this.session.sessionCrypto.encrypt(JSON.stringify(Object.assign(Object.assign({},e),{id:m})),dt(this.session.walletPublicKey));try{yield this.gateway.send(H,this.session.walletPublicKey,e.method,{attempts:f==null?void 0:f.attempts,signal:f==null?void 0:f.signal}),(p=f==null?void 0:f.onRequestSent)===null||p===void 0||p.call(f),this.pendingRequests.set(m.toString(),l)}catch(q){h(q)}}))}closeConnection(){this.closeGateways(),this.listeners=[],this.session=null,this.gateway=null}disconnect(e){return T(this,void 0,void 0,function*(){return new Promise(n=>T(this,void 0,void 0,function*(){let f=!1,l=null;const h=()=>{f||(f=!0,this.removeBridgeAndSession().then(n))};try{this.closeGateways();const p=_e(e==null?void 0:e.signal);l=setTimeout(()=>{p.abort()},this.defaultOpeningDeadlineMS),yield this.sendRequest({method:"disconnect",params:[]},{onRequestSent:h,signal:p.signal,attempts:1})}catch(p){le("Disconnect error:",p),f||this.removeBridgeAndSession().then(n)}finally{l&&clearTimeout(l),h()}}))})}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter(n=>n!==e)}pause(){var e;(e=this.gateway)===null||e===void 0||e.pause(),this.pendingGateways.forEach(n=>n.pause())}unPause(){return T(this,void 0,void 0,function*(){const e=this.pendingGateways.map(n=>n.unPause());this.gateway&&e.push(this.gateway.unPause()),yield Promise.all(e)})}pendingGatewaysListener(e,n,f){return T(this,void 0,void 0,function*(){if(!this.pendingGateways.includes(e)){yield e.close();return}return this.closeGateways({except:e}),this.gateway&&(le("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.session.bridgeUrl=n,this.gateway=e,this.gateway.setErrorsListener(this.gatewayErrorsListener.bind(this)),this.gateway.setListener(this.gatewayListener.bind(this)),this.gatewayListener(f)})}gatewayListener(e){return T(this,void 0,void 0,function*(){const n=JSON.parse(this.session.sessionCrypto.decrypt(En.decode(e.message).toUint8Array(),dt(e.from)));if(le("Wallet message received:",n),!("event"in n)){const l=n.id.toString(),h=this.pendingRequests.get(l);if(!h){le(`Response id ${l} doesn't match any request's id`);return}h(n),this.pendingRequests.delete(l);return}if(n.id!==void 0){const l=yield this.connectionStorage.getLastWalletEventId();if(l!==void 0&&n.id<=l){Ue(`Received event id (=${n.id}) must be greater than stored last wallet event id (=${l}) `);return}n.event!=="connect"&&(yield this.connectionStorage.storeLastWalletEventId(n.id))}const f=this.listeners;n.event==="connect"&&(yield this.updateSession(n,e.from)),n.event==="disconnect"&&(le("Removing bridge and session: received disconnect event"),yield this.removeBridgeAndSession()),f.forEach(l=>l(n))})}gatewayErrorsListener(e){return T(this,void 0,void 0,function*(){throw new B(`Bridge error ${JSON.stringify(e)}`)})}updateSession(e,n){return T(this,void 0,void 0,function*(){this.session=Object.assign(Object.assign({},this.session),{walletPublicKey:n});const f=e.payload.items.find(h=>h.name==="ton_addr"),l=Object.assign(Object.assign({},e),{payload:Object.assign(Object.assign({},e.payload),{items:[f]})});yield this.connectionStorage.storeConnection({type:"http",session:this.session,lastWalletEventId:e.id,connectEvent:l,nextRpcRequestId:0})})}removeBridgeAndSession(){return T(this,void 0,void 0,function*(){this.closeConnection(),yield this.connectionStorage.removeConnection()})}generateUniversalLink(e,n){return fr(e)?this.generateTGUniversalLink(e,n):this.generateRegularUniversalLink(e,n)}generateRegularUniversalLink(e,n){const f=new URL(e);return f.searchParams.append("v",Tn.toString()),f.searchParams.append("id",this.session.sessionCrypto.sessionId),f.searchParams.append("r",JSON.stringify(n)),f.toString()}generateTGUniversalLink(e,n){const l=this.generateRegularUniversalLink("about:blank",n).split("?")[1],h="tonconnect-"+cr(l),p=this.convertToDirectLink(e),m=new URL(p);return m.searchParams.append("startapp",h),m.toString()}convertToDirectLink(e){const n=new URL(e);return n.searchParams.has("attach")&&(n.searchParams.delete("attach"),n.pathname+="/start"),n.toString()}openGateways(e,n){return T(this,void 0,void 0,function*(){if(Array.isArray(this.walletConnectionSource)){this.pendingGateways.map(f=>f.close().catch()),this.pendingGateways=this.walletConnectionSource.map(f=>{const l=new Kt(this.storage,f.bridgeUrl,e.sessionId,()=>{},()=>{});return l.setListener(h=>this.pendingGatewaysListener(l,f.bridgeUrl,h)),l}),yield Promise.allSettled(this.pendingGateways.map(f=>Ge(l=>{var h;return this.pendingGateways.some(p=>p===f)?f.registerSession({openingDeadlineMS:(h=n==null?void 0:n.openingDeadlineMS)!==null&&h!==void 0?h:this.defaultOpeningDeadlineMS,signal:l.signal}):f.close()},{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:n==null?void 0:n.signal})));return}else return this.gateway&&(le("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.gateway=new Kt(this.storage,this.walletConnectionSource.bridgeUrl,e.sessionId,this.gatewayListener.bind(this),this.gatewayErrorsListener.bind(this)),yield this.gateway.registerSession({openingDeadlineMS:n==null?void 0:n.openingDeadlineMS,signal:n==null?void 0:n.signal})})}closeGateways(e){var n;(n=this.gateway)===null||n===void 0||n.close(),this.pendingGateways.filter(f=>f!==(e==null?void 0:e.except)).forEach(f=>f.close()),this.pendingGateways=[]}}function _n(a,e){return Rn(a,[e])}function Rn(a,e){return!a||typeof a!="object"?!1:e.every(n=>n in a)}function xr(a){try{return!_n(a,"tonconnect")||!_n(a.tonconnect,"walletInfo")?!1:Rn(a.tonconnect.walletInfo,["name","app_name","image","about_url","platforms"])}catch{return!1}}class ke{constructor(){this.storage={}}static getInstance(){return ke.instance||(ke.instance=new ke),ke.instance}get length(){return Object.keys(this.storage).length}clear(){this.storage={}}getItem(e){var n;return(n=this.storage[e])!==null&&n!==void 0?n:null}key(e){var n;const f=Object.keys(this.storage);return e<0||e>=f.length?null:(n=f[e])!==null&&n!==void 0?n:null}removeItem(e){delete this.storage[e]}setItem(e,n){this.storage[e]=n}}function bt(){if(!(typeof window>"u"))return window}function gr(){const a=bt();if(!a)return[];try{return Object.keys(a)}catch{return[]}}function pr(){if(!(typeof document>"u"))return document}function vr(){var a;const e=(a=bt())===null||a===void 0?void 0:a.location.origin;return e?e+"/tonconnect-manifest.json":""}function br(){if(yr())return localStorage;if(wr())throw new B("`localStorage` is unavailable, but it is required for TonConnect. For more details, see https://github.com/ton-connect/sdk/tree/main/packages/sdk#init-connector");return ke.getInstance()}function yr(){try{return typeof localStorage<"u"}catch{return!1}}function wr(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}class pe{constructor(e,n){this.injectedWalletKey=n,this.type="injected",this.unsubscribeCallback=null,this.listenSubscriptions=!1,this.listeners=[];const f=pe.window;if(!pe.isWindowContainsWallet(f,n))throw new Gt;this.connectionStorage=new Je(e),this.injectedWallet=f[n].tonconnect}static fromStorage(e){return T(this,void 0,void 0,function*(){const f=yield new Je(e).getInjectedConnection();return new pe(e,f.jsBridgeKey)})}static isWalletInjected(e){return pe.isWindowContainsWallet(this.window,e)}static isInsideWalletBrowser(e){return pe.isWindowContainsWallet(this.window,e)?this.window[e].tonconnect.isWalletBrowser:!1}static getCurrentlyInjectedWallets(){return this.window?gr().filter(([f,l])=>xr(l)).map(([f,l])=>({name:l.tonconnect.walletInfo.name,appName:l.tonconnect.walletInfo.app_name,aboutUrl:l.tonconnect.walletInfo.about_url,imageUrl:l.tonconnect.walletInfo.image,tondns:l.tonconnect.walletInfo.tondns,jsBridgeKey:f,injected:!0,embedded:l.tonconnect.isWalletBrowser,platforms:l.tonconnect.walletInfo.platforms,features:l.tonconnect.walletInfo.features})):[]}static isWindowContainsWallet(e,n){return!!e&&n in e&&typeof e[n]=="object"&&"tonconnect"in e[n]}connect(e){this._connect(Tn,e)}restoreConnection(){return T(this,void 0,void 0,function*(){try{le("Injected Provider restoring connection...");const e=yield this.injectedWallet.restoreConnection();le("Injected Provider restoring connection response",e),e.event==="connect"?(this.makeSubscriptions(),this.listeners.forEach(n=>n(e))):yield this.connectionStorage.removeConnection()}catch(e){yield this.connectionStorage.removeConnection(),console.error(e)}})}closeConnection(){this.listenSubscriptions&&this.injectedWallet.disconnect(),this.closeAllListeners()}disconnect(){return T(this,void 0,void 0,function*(){return new Promise(e=>{const n=()=>{this.closeAllListeners(),this.connectionStorage.removeConnection().then(e)};try{this.injectedWallet.disconnect(),n()}catch(f){le(f),this.sendRequest({method:"disconnect",params:[]},n)}})})}closeAllListeners(){var e;this.listenSubscriptions=!1,this.listeners=[],(e=this.unsubscribeCallback)===null||e===void 0||e.call(this)}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter(n=>n!==e)}sendRequest(e,n){var f;return T(this,void 0,void 0,function*(){const l={};typeof n=="function"?l.onRequestSent=n:(l.onRequestSent=n==null?void 0:n.onRequestSent,l.signal=n==null?void 0:n.signal);const h=(yield this.connectionStorage.getNextRpcRequestId()).toString();yield this.connectionStorage.increaseNextRpcRequestId(),le("Send injected-bridge request:",Object.assign(Object.assign({},e),{id:h}));const p=this.injectedWallet.send(Object.assign(Object.assign({},e),{id:h}));return p.then(m=>le("Wallet message received:",m)),(f=l==null?void 0:l.onRequestSent)===null||f===void 0||f.call(l),p})}_connect(e,n){return T(this,void 0,void 0,function*(){try{le(`Injected Provider connect request: protocolVersion: ${e}, message:`,n);const f=yield this.injectedWallet.connect(e,n);le("Injected Provider connect response:",f),f.event==="connect"&&(yield this.updateSession(),this.makeSubscriptions()),this.listeners.forEach(l=>l(f))}catch(f){le("Injected Provider connect error:",f);const l={event:"connect_error",payload:{code:0,message:f==null?void 0:f.toString()}};this.listeners.forEach(h=>h(l))}})}makeSubscriptions(){this.listenSubscriptions=!0,this.unsubscribeCallback=this.injectedWallet.listen(e=>{le("Wallet message received:",e),this.listenSubscriptions&&this.listeners.forEach(n=>n(e)),e.event==="disconnect"&&this.disconnect()})}updateSession(){return this.connectionStorage.storeConnection({type:"injected",jsBridgeKey:this.injectedWalletKey,nextRpcRequestId:0})}}pe.window=bt();class mr{constructor(){this.localStorage=br()}getItem(e){return T(this,void 0,void 0,function*(){return this.localStorage.getItem(e)})}removeItem(e){return T(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}setItem(e,n){return T(this,void 0,void 0,function*(){this.localStorage.setItem(e,n)})}}function _r(a){return Er(a)&&a.injected}function Sr(a){return _r(a)&&a.embedded}function Er(a){return"jsBridgeKey"in a}const Ur=[{app_name:"telegram-wallet",name:"Wallet",image:"https://wallet.tg/images/logo-288.png",about_url:"https://wallet.tg/",universal_url:"https://t.me/wallet?attach=wallet",bridge:[{type:"sse",url:"https://walletbot.me/tonconnect-bridge/bridge"}],platforms:["ios","android","macos","windows","linux"]},{app_name:"tonkeeper",name:"Tonkeeper",image:"https://tonkeeper.com/assets/tonconnect-icon.png",tondns:"tonkeeper.ton",about_url:"https://tonkeeper.com",universal_url:"https://app.tonkeeper.com/ton-connect",deepLink:"tonkeeper-tc://",bridge:[{type:"sse",url:"https://bridge.tonapi.io/bridge"},{type:"js",key:"tonkeeper"}],platforms:["ios","android","chrome","firefox","macos"]},{app_name:"mytonwallet",name:"MyTonWallet",image:"https://static.mytonwallet.io/icon-256.png",about_url:"https://mytonwallet.io",universal_url:"https://connect.mytonwallet.org",bridge:[{type:"js",key:"mytonwallet"},{type:"sse",url:"https://tonconnectbridge.mytonwallet.org/bridge/"}],platforms:["chrome","windows","macos","linux","ios","android","firefox"]},{app_name:"tonhub",name:"Tonhub",image:"https://tonhub.com/tonconnect_logo.png",about_url:"https://tonhub.com",universal_url:"https://tonhub.com/ton-connect",bridge:[{type:"js",key:"tonhub"},{type:"sse",url:"https://connect.tonhubapi.com/tonconnect"}],platforms:["ios","android"]},{app_name:"bitgetTonWallet",name:"Bitget Wallet",image:"https://raw.githubusercontent.com/bitgetwallet/download/refs/heads/main/logo/png/bitget_wallet_logo_288_mini.png",about_url:"https://web3.bitget.com",deepLink:"bitkeep://",bridge:[{type:"js",key:"bitgetTonWallet"},{type:"sse",url:"https://ton-connect-bridge.bgwapi.io/bridge"}],platforms:["ios","android","chrome"],universal_url:"https://bkcode.vip/ton-connect"},{app_name:"okxMiniWallet",name:"OKX Mini Wallet",image:"https://static.okx.com/cdn/assets/imgs/2411/8BE1A4A434D8F58A.png",about_url:"https://www.okx.com/web3",universal_url:"https://t.me/OKX_WALLET_BOT?attach=wallet",bridge:[{type:"sse",url:"https://www.okx.com/tonbridge/discover/rpc/bridge"}],platforms:["ios","android","macos","windows","linux"]},{app_name:"binanceWeb3TonWallet",name:"Binance Web3 Wallet",image:"https://public.bnbstatic.com/static/binance-w3w/ton-provider/binancew3w.png",about_url:"https://www.binance.com/en/web3wallet",deepLink:"bnc://app.binance.com/cedefi/ton-connect",bridge:[{type:"js",key:"binancew3w"},{type:"sse",url:"https://wallet.binance.com/tonbridge/bridge"}],platforms:["ios","android","macos","windows","linux"],universal_url:"https://app.binance.com/cedefi/ton-connect"},{app_name:"fintopio-tg",name:"Fintopio",image:"https://fintopio.com/tonconnect-icon.png",about_url:"https://fintopio.com",universal_url:"https://t.me/fintopio?attach=wallet",bridge:[{type:"sse",url:"https://wallet-bridge.fintopio.com/bridge"}],platforms:["ios","android","macos","windows","linux"]},{app_name:"okxTonWallet",name:"OKX Wallet",image:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png",about_url:"https://www.okx.com/web3",universal_url:"https://www.okx.com/download?appendQuery=true&deeplink=okx://web3/wallet/tonconnect",bridge:[{type:"js",key:"okxTonWallet"},{type:"sse",url:"https://www.okx.com/tonbridge/discover/rpc/bridge"}],platforms:["chrome","safari","firefox","ios","android"]},{app_name:"hot",name:"HOT",image:"https://raw.githubusercontent.com/hot-dao/media/main/logo.png",about_url:"https://hot-labs.org/",universal_url:"https://t.me/herewalletbot?attach=wallet",bridge:[{type:"sse",url:"https://sse-bridge.hot-labs.org"},{type:"js",key:"hotWallet"}],platforms:["ios","android","macos","windows","linux"]},{app_name:"bybitTonWallet",name:"Bybit Wallet",image:"https://raw.githubusercontent.com/bybit-web3/bybit-web3.github.io/main/docs/images/bybit-logo.png",about_url:"https://www.bybit.com/web3",universal_url:"https://app.bybit.com/ton-connect",deepLink:"bybitapp://",bridge:[{type:"js",key:"bybitTonWallet"},{type:"sse",url:"https://api-node.bybit.com/spot/api/web3/bridge/ton/bridge"}],platforms:["ios","android","chrome"]},{app_name:"dewallet",name:"DeWallet",image:"https://raw.githubusercontent.com/delab-team/manifests-images/main/WalletAvatar.png",about_url:"https://delabwallet.com",universal_url:"https://t.me/dewallet?attach=wallet",bridge:[{type:"sse",url:"https://bridge.dewallet.pro/bridge"}],platforms:["ios","android","macos","windows","linux"]},{app_name:"safepalwallet",name:"SafePal",image:"https://s.pvcliping.com/web/public_image/SafePal_x288.png",tondns:"",about_url:"https://www.safepal.com",universal_url:"https://link.safepal.io/ton-connect",deepLink:"safepal-tc://",bridge:[{type:"sse",url:"https://ton-bridge.safepal.com/tonbridge/v1/bridge"},{type:"js",key:"safepalwallet"}],platforms:["ios","android","chrome","firefox"]},{app_name:"GateWallet",name:"GateWallet",image:"https://img.gatedataimg.com/prd-ordinal-imgs/036f07bb8730716e/gateio-0925.png",about_url:"https://www.gate.io/",bridge:[{type:"js",key:"gatetonwallet"},{type:"sse",url:"https://dapp.gateio.services/tonbridge_api/bridge/v1"}],platforms:["ios","android"],universal_url:"https://gateio.go.link/gateio/web3?adj_t=1ff8khdw_1fu4ccc7"},{app_name:"openmask",name:"OpenMask",image:"https://raw.githubusercontent.com/OpenProduct/openmask-extension/main/public/openmask-logo-288.png",about_url:"https://www.openmask.app/",bridge:[{type:"js",key:"openmask"}],platforms:["chrome"]},{app_name:"BitgetWeb3",name:"BitgetWeb3",image:"https://img.bitgetimg.com/image/third/1731638059795.png",about_url:"​https://www.bitget.com",universal_url:"https://t.me/BitgetOfficialBot?attach=wallet",bridge:[{type:"sse",url:"https://ton-connect-bridge.bgwapi.io/bridge"}],platforms:["ios","android","windows","macos","linux"]},{app_name:"tobi",name:"Tobi",image:"https://app.tobiwallet.app/icons/logo-288.png",about_url:"https://tobi.fun",universal_url:"https://t.me/TobiCopilotBot?attach=wallet",bridge:[{type:"sse",url:"https://ton-bridge.tobiwallet.app/bridge"}],platforms:["ios","android","macos","windows","linux"]},{app_name:"xtonwallet",name:"XTONWallet",image:"https://xtonwallet.com/assets/img/icon-256-back.png",about_url:"https://xtonwallet.com",bridge:[{type:"js",key:"xtonwallet"}],platforms:["chrome","firefox"]},{app_name:"tonwallet",name:"TON Wallet",image:"https://wallet.ton.org/assets/ui/qr-logo.png",about_url:"https://chrome.google.com/webstore/detail/ton-wallet/nphplpgoakhhjchkkhmiggakijnkhfnd",bridge:[{type:"js",key:"tonwallet"}],platforms:["chrome"]}];class qt{constructor(e){var n;this.walletsListCache=null,this.walletsListCacheCreationTimestamp=null,this.walletsListSource=(n=e==null?void 0:e.walletsListSource)!==null&&n!==void 0?n:"https://raw.githubusercontent.com/ton-blockchain/wallets-list/main/wallets-v2.json",this.cacheTTLMs=e==null?void 0:e.cacheTTLMs}getWallets(){return T(this,void 0,void 0,function*(){return this.cacheTTLMs&&this.walletsListCacheCreationTimestamp&&Date.now()>this.walletsListCacheCreationTimestamp+this.cacheTTLMs&&(this.walletsListCache=null),this.walletsListCache||(this.walletsListCache=this.fetchWalletsList(),this.walletsListCache.then(()=>{this.walletsListCacheCreationTimestamp=Date.now()}).catch(()=>{this.walletsListCache=null,this.walletsListCacheCreationTimestamp=null})),this.walletsListCache})}getEmbeddedWallet(){return T(this,void 0,void 0,function*(){const n=(yield this.getWallets()).filter(Sr);return n.length===1?n[0]:null})}fetchWalletsList(){return T(this,void 0,void 0,function*(){let e=[];try{if(e=yield(yield fetch(this.walletsListSource)).json(),!Array.isArray(e))throw new Ht("Wrong wallets list format, wallets list must be an array.");const l=e.filter(h=>!this.isCorrectWalletConfigDTO(h));l.length&&(Ue(`Wallet(s) ${l.map(h=>(h==null?void 0:h.name)||"unknown").join(", ")} config format is wrong. They were removed from the wallets list.`),e=e.filter(h=>this.isCorrectWalletConfigDTO(h)))}catch(f){Ue(f),e=Ur}let n=[];try{n=pe.getCurrentlyInjectedWallets()}catch(f){Ue(f)}return this.mergeWalletsLists(this.walletConfigDTOListToWalletConfigList(e),n)})}walletConfigDTOListToWalletConfigList(e){return e.map(n=>{const f={name:n.name,appName:n.app_name,imageUrl:n.image,aboutUrl:n.about_url,tondns:n.tondns,platforms:n.platforms,features:n.features};return n.bridge.forEach(l=>{if(l.type==="sse"&&(f.bridgeUrl=l.url,f.universalLink=n.universal_url,f.deepLink=n.deepLink),l.type==="js"){const h=l.key;f.jsBridgeKey=h,f.injected=pe.isWalletInjected(h),f.embedded=pe.isInsideWalletBrowser(h)}}),f})}mergeWalletsLists(e,n){return[...new Set(e.concat(n).map(l=>l.name)).values()].map(l=>{const h=e.find(m=>m.name===l),p=n.find(m=>m.name===l);return Object.assign(Object.assign({},h&&Object.assign({},h)),p&&Object.assign({},p))})}isCorrectWalletConfigDTO(e){if(!e||typeof e!="object")return!1;const n="name"in e,f="app_name"in e,l="image"in e,h="about_url"in e,p="platforms"in e;if(!n||!l||!h||!p||!f||!e.platforms||!Array.isArray(e.platforms)||!e.platforms.length||!("bridge"in e)||!Array.isArray(e.bridge)||!e.bridge.length)return!1;const m=e.bridge;if(m.some(re=>!re||typeof re!="object"||!("type"in re)))return!1;const H=m.find(re=>re.type==="sse");if(H&&(!(typeof H=="object"&&"url"in H)||!H.url||!e.universal_url))return!1;const q=m.find(re=>re.type==="js");return!(q&&(typeof q!="object"||!("key"in q)||!q.key))}}function Cr(a,e){const n=a.includes("SendTransaction"),f=Pn(a,"SendTransaction");if(!n&&!f)throw new Ye("Wallet doesn't support SendTransaction feature.");if(e.requireExtraCurrencies&&(!f||!f.extraCurrencySupported))throw new Ye("Wallet is not able to handle such SendTransaction request. Extra currencies support is required.");if(f&&f.maxMessages!==void 0){if(f.maxMessages<e.requiredMessagesNumber)throw new Ye(`Wallet is not able to handle such SendTransaction request. Max support messages number is ${f.maxMessages}, but ${e.requiredMessagesNumber} is required.`);return}lr("Connected wallet didn't provide information about max allowed messages in the SendTransaction request. Request may be rejected by the wallet.")}function Tr(a,e){if(typeof e!="object")return!0;const{sendTransaction:n}=e;if(n){const f=Pn(a,"SendTransaction");if(!f||!Rr(f,n))return!1}return!0}function Pn(a,e){return a.find(n=>n&&typeof n=="object"&&n.name===e)}function Rr(a,e){const n=e.minMessages===void 0||e.minMessages<=a.maxMessages,f=!e.extraCurrencyRequired||a.extraCurrencySupported;return!!(n&&f)}function Pr(){return{type:"request-version"}}function Ar(a){return{type:"response-version",version:a}}function Ne(a){return{ton_connect_sdk_lib:a.ton_connect_sdk_lib,ton_connect_ui_lib:a.ton_connect_ui_lib}}function Ke(a,e){var n,f,l,h,p,m,H,q;const V=((n=e==null?void 0:e.connectItems)===null||n===void 0?void 0:n.tonProof)&&"proof"in e.connectItems.tonProof?"ton_proof":"ton_addr";return{wallet_address:(l=(f=e==null?void 0:e.account)===null||f===void 0?void 0:f.address)!==null&&l!==void 0?l:null,wallet_type:(h=e==null?void 0:e.device.appName)!==null&&h!==void 0?h:null,wallet_version:(p=e==null?void 0:e.device.appVersion)!==null&&p!==void 0?p:null,auth_type:V,custom_data:Object.assign({chain_id:(H=(m=e==null?void 0:e.account)===null||m===void 0?void 0:m.chain)!==null&&H!==void 0?H:null,provider:(q=e==null?void 0:e.provider)!==null&&q!==void 0?q:null},Ne(a))}}function jr(a){return{type:"connection-started",custom_data:Ne(a)}}function Lr(a,e){return Object.assign({type:"connection-completed",is_success:!0},Ke(a,e))}function Wr(a,e,n){return{type:"connection-error",is_success:!1,error_message:e,error_code:n??null,custom_data:Ne(a)}}function Br(a){return{type:"connection-restoring-started",custom_data:Ne(a)}}function Mr(a,e){return Object.assign({type:"connection-restoring-completed",is_success:!0},Ke(a,e))}function Ir(a,e){return{type:"connection-restoring-error",is_success:!1,error_message:e,custom_data:Ne(a)}}function Jt(a,e){var n,f,l,h;return{valid_until:(n=String(e.validUntil))!==null&&n!==void 0?n:null,from:(h=(f=e.from)!==null&&f!==void 0?f:(l=a==null?void 0:a.account)===null||l===void 0?void 0:l.address)!==null&&h!==void 0?h:null,messages:e.messages.map(p=>{var m,H;return{address:(m=p.address)!==null&&m!==void 0?m:null,amount:(H=p.amount)!==null&&H!==void 0?H:null}})}}function kr(a,e,n){return Object.assign(Object.assign({type:"transaction-sent-for-signature"},Ke(a,e)),Jt(e,n))}function Nr(a,e,n,f){return Object.assign(Object.assign({type:"transaction-signed",is_success:!0,signed_transaction:f.boc},Ke(a,e)),Jt(e,n))}function Kr(a,e,n,f,l){return Object.assign(Object.assign({type:"transaction-signing-failed",is_success:!1,error_message:f,error_code:l??null},Ke(a,e)),Jt(e,n))}function Or(a,e,n){return Object.assign({type:"disconnection",scope:n},Ke(a,e))}class Fr{constructor(){this.window=bt()}dispatchEvent(e,n){var f;return T(this,void 0,void 0,function*(){const l=new CustomEvent(e,{detail:n});(f=this.window)===null||f===void 0||f.dispatchEvent(l)})}addEventListener(e,n,f){var l;return T(this,void 0,void 0,function*(){return(l=this.window)===null||l===void 0||l.addEventListener(e,n,f),()=>{var h;return(h=this.window)===null||h===void 0?void 0:h.removeEventListener(e,n)}})}}class qr{constructor(e){var n;this.eventPrefix="ton-connect-",this.tonConnectUiVersion=null,this.eventDispatcher=(n=e==null?void 0:e.eventDispatcher)!==null&&n!==void 0?n:new Fr,this.tonConnectSdkVersion=e.tonConnectSdkVersion,this.init().catch()}get version(){return Ne({ton_connect_sdk_lib:this.tonConnectSdkVersion,ton_connect_ui_lib:this.tonConnectUiVersion})}init(){return T(this,void 0,void 0,function*(){try{yield this.setRequestVersionHandler(),this.tonConnectUiVersion=yield this.requestTonConnectUiVersion()}catch{}})}setRequestVersionHandler(){return T(this,void 0,void 0,function*(){yield this.eventDispatcher.addEventListener("ton-connect-request-version",()=>T(this,void 0,void 0,function*(){yield this.eventDispatcher.dispatchEvent("ton-connect-response-version",Ar(this.tonConnectSdkVersion))}))})}requestTonConnectUiVersion(){return T(this,void 0,void 0,function*(){return new Promise((e,n)=>T(this,void 0,void 0,function*(){try{yield this.eventDispatcher.addEventListener("ton-connect-ui-response-version",f=>{e(f.detail.version)},{once:!0}),yield this.eventDispatcher.dispatchEvent("ton-connect-ui-request-version",Pr())}catch(f){n(f)}}))})}dispatchUserActionEvent(e){try{this.eventDispatcher.dispatchEvent(`${this.eventPrefix}${e.type}`,e).catch()}catch{}}trackConnectionStarted(...e){try{const n=jr(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionCompleted(...e){try{const n=Lr(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionError(...e){try{const n=Wr(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionRestoringStarted(...e){try{const n=Br(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionRestoringCompleted(...e){try{const n=Mr(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionRestoringError(...e){try{const n=Ir(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackDisconnection(...e){try{const n=Or(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackTransactionSentForSignature(...e){try{const n=kr(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackTransactionSigned(...e){try{const n=Nr(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackTransactionSigningFailed(...e){try{const n=Kr(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}}const Dr="3.1.0";class yt{constructor(e){if(this.walletsList=new qt,this._wallet=null,this.provider=null,this.statusChangeSubscriptions=[],this.statusChangeErrorSubscriptions=[],this.dappSettings={manifestUrl:(e==null?void 0:e.manifestUrl)||vr(),storage:(e==null?void 0:e.storage)||new mr},this.walletsRequiredFeatures=e==null?void 0:e.walletsRequiredFeatures,this.walletsList=new qt({walletsListSource:e==null?void 0:e.walletsListSource,cacheTTLMs:e==null?void 0:e.walletsListCacheTTLMs}),this.tracker=new qr({eventDispatcher:e==null?void 0:e.eventDispatcher,tonConnectSdkVersion:Dr}),!this.dappSettings.manifestUrl)throw new Dt("Dapp tonconnect-manifest.json must be specified if window.location.origin is undefined. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest");this.bridgeConnectionStorage=new Je(this.dappSettings.storage),e!=null&&e.disableAutoPauseConnection||this.addWindowFocusAndBlurSubscriptions()}static getWallets(){return this.walletsList.getWallets()}get connected(){return this._wallet!==null}get account(){var e;return((e=this._wallet)===null||e===void 0?void 0:e.account)||null}get wallet(){return this._wallet}set wallet(e){this._wallet=e,this.statusChangeSubscriptions.forEach(n=>n(this._wallet))}getWallets(){return this.walletsList.getWallets()}onStatusChange(e,n){return this.statusChangeSubscriptions.push(e),n&&this.statusChangeErrorSubscriptions.push(n),()=>{this.statusChangeSubscriptions=this.statusChangeSubscriptions.filter(f=>f!==e),n&&(this.statusChangeErrorSubscriptions=this.statusChangeErrorSubscriptions.filter(f=>f!==n))}}connect(e,n){var f,l;const h={};if(typeof n=="object"&&"tonProof"in n&&(h.request=n),typeof n=="object"&&("openingDeadlineMS"in n||"signal"in n||"request"in n)&&(h.request=n==null?void 0:n.request,h.openingDeadlineMS=n==null?void 0:n.openingDeadlineMS,h.signal=n==null?void 0:n.signal),this.connected)throw new Yt;const p=_e(h==null?void 0:h.signal);if((f=this.abortController)===null||f===void 0||f.abort(),this.abortController=p,p.signal.aborted)throw new B("Connection was aborted");return(l=this.provider)===null||l===void 0||l.closeConnection(),this.provider=this.createProvider(e),p.signal.addEventListener("abort",()=>{var m;(m=this.provider)===null||m===void 0||m.closeConnection(),this.provider=null}),this.tracker.trackConnectionStarted(),this.provider.connect(this.createConnectRequest(h==null?void 0:h.request),{openingDeadlineMS:h==null?void 0:h.openingDeadlineMS,signal:p.signal})}restoreConnection(e){var n,f;return T(this,void 0,void 0,function*(){this.tracker.trackConnectionRestoringStarted();const l=_e(e==null?void 0:e.signal);if((n=this.abortController)===null||n===void 0||n.abort(),this.abortController=l,l.signal.aborted){this.tracker.trackConnectionRestoringError("Connection restoring was aborted");return}const[h,p]=yield Promise.all([this.bridgeConnectionStorage.storedConnectionType(),this.walletsList.getEmbeddedWallet()]);if(l.signal.aborted){this.tracker.trackConnectionRestoringError("Connection restoring was aborted");return}let m=null;try{switch(h){case"http":m=yield ze.fromStorage(this.dappSettings.storage);break;case"injected":m=yield pe.fromStorage(this.dappSettings.storage);break;default:if(p)m=this.createProvider(p);else return}}catch{this.tracker.trackConnectionRestoringError("Provider is not restored"),yield this.bridgeConnectionStorage.removeConnection(),m==null||m.closeConnection(),m=null;return}if(l.signal.aborted){m==null||m.closeConnection(),this.tracker.trackConnectionRestoringError("Connection restoring was aborted");return}if(!m){Ue("Provider is not restored"),this.tracker.trackConnectionRestoringError("Provider is not restored");return}(f=this.provider)===null||f===void 0||f.closeConnection(),this.provider=m,m.listen(this.walletEventsListener.bind(this));const H=()=>{this.tracker.trackConnectionRestoringError("Connection restoring was aborted"),m==null||m.closeConnection(),m=null};l.signal.addEventListener("abort",H);const q=Ge(V=>T(this,void 0,void 0,function*(){yield m==null?void 0:m.restoreConnection({openingDeadlineMS:e==null?void 0:e.openingDeadlineMS,signal:V.signal}),l.signal.removeEventListener("abort",H),this.connected?this.tracker.trackConnectionRestoringCompleted(this.wallet):this.tracker.trackConnectionRestoringError("Connection restoring failed")}),{attempts:Number.MAX_SAFE_INTEGER,delayMs:2e3,signal:e==null?void 0:e.signal}),re=new Promise(V=>setTimeout(()=>V(),12e3));return Promise.race([q,re])})}sendTransaction(e,n){return T(this,void 0,void 0,function*(){const f={};typeof n=="function"?f.onRequestSent=n:(f.onRequestSent=n==null?void 0:n.onRequestSent,f.signal=n==null?void 0:n.signal);const l=_e(f==null?void 0:f.signal);if(l.signal.aborted)throw new B("Transaction sending was aborted");this.checkConnection();const h=e.messages.length,p=e.messages.some(ue=>ue.extraCurrency&&Object.keys(ue.extraCurrency).length>0);Cr(this.wallet.device.features,{requiredMessagesNumber:h,requireExtraCurrencies:p}),this.tracker.trackTransactionSentForSignature(this.wallet,e);const{validUntil:m,messages:H}=e,q=yn(e,["validUntil","messages"]),re=e.from||this.account.address,V=e.network||this.account.chain,de=yield this.provider.sendRequest(ct.convertToRpcRequest(Object.assign(Object.assign({},q),{from:re,network:V,valid_until:m,messages:H.map(ue=>{var{extraCurrency:Re}=ue,Xe=yn(ue,["extraCurrency"]);return Object.assign(Object.assign({},Xe),{extra_currency:Re})})})),{onRequestSent:f.onRequestSent,signal:l.signal});if(ct.isError(de))return this.tracker.trackTransactionSigningFailed(this.wallet,e,de.error.message,de.error.code),ct.parseAndThrowError(de);const ye=ct.convertFromRpcResponse(de);return this.tracker.trackTransactionSigned(this.wallet,e,ye),ye})}disconnect(e){var n;return T(this,void 0,void 0,function*(){if(!this.connected)throw new ut;const f=_e(e==null?void 0:e.signal),l=this.abortController;if(this.abortController=f,f.signal.aborted)throw new B("Disconnect was aborted");this.onWalletDisconnected("dapp"),yield(n=this.provider)===null||n===void 0?void 0:n.disconnect({signal:f.signal}),l==null||l.abort()})}pauseConnection(){var e;((e=this.provider)===null||e===void 0?void 0:e.type)==="http"&&this.provider.pause()}unPauseConnection(){var e;return((e=this.provider)===null||e===void 0?void 0:e.type)!=="http"?Promise.resolve():this.provider.unPause()}addWindowFocusAndBlurSubscriptions(){const e=pr();if(e)try{e.addEventListener("visibilitychange",()=>{e.hidden?this.pauseConnection():this.unPauseConnection().catch()})}catch(n){Ue("Cannot subscribe to the document.visibilitychange: ",n)}}createProvider(e){let n;return!Array.isArray(e)&&tr(e)?n=new pe(this.dappSettings.storage,e.jsBridgeKey):n=new ze(this.dappSettings.storage,e),n.listen(this.walletEventsListener.bind(this)),n}walletEventsListener(e){switch(e.event){case"connect":this.onWalletConnected(e.payload);break;case"connect_error":this.tracker.trackConnectionError(e.payload.message,e.payload.code);const n=rr.parseError(e.payload);this.onWalletConnectError(n);break;case"disconnect":this.onWalletDisconnected("wallet")}}onWalletConnected(e){var n;const f=e.items.find(m=>m.name==="ton_addr"),l=e.items.find(m=>m.name==="ton_proof");if(!f)throw new B("ton_addr connection item was not found");if(!Tr(e.device.features,this.walletsRequiredFeatures)){(n=this.provider)===null||n===void 0||n.disconnect(),this.onWalletConnectError(new $t("Wallet does not support required features",{cause:{connectEvent:e}}));return}const p={device:e.device,provider:this.provider.type,account:{address:f.address,chain:f.network,walletStateInit:f.walletStateInit,publicKey:f.publicKey}};l&&(p.connectItems={tonProof:l}),this.wallet=p,this.tracker.trackConnectionCompleted(p)}onWalletConnectError(e){if(this.statusChangeErrorSubscriptions.forEach(n=>n(e)),le(e),e instanceof xt||e instanceof ht)throw Ue(e),e}onWalletDisconnected(e){this.tracker.trackDisconnection(this.wallet,e),this.wallet=null}checkConnection(){if(!this.connected)throw new ut}createConnectRequest(e){const n=[{name:"ton_addr"}];return e!=null&&e.tonProof&&n.push({name:"ton_proof",payload:e.tonProof}),{manifestUrl:this.dappSettings.manifestUrl,items:n}}}yt.walletsList=new qt;yt.isWalletInjected=a=>pe.isWalletInjected(a);yt.isInsideWalletBrowser=a=>pe.isInsideWalletBrowser(a);for(let a=0;a<=255;a++){let e=a.toString(16);e.length<2&&(e="0"+e)}const Ot=new yt;async function Yr(){try{if(await Ot.restoreConnection(),await Ot.connectWallet()){const e=Ot.wallet.account.address,n=document.getElementById("walletInfo"),f=document.getElementById("walletAddress"),l=document.getElementById("walletBalance");f.textContent=e,l.textContent="Загружаем баланс...";const p=await(await fetch(`https://toncenter.com/api/v2/getAddressBalance?address=${e}`)).json();if(p.ok){const m=(parseInt(p.result,10)/1e9).toFixed(4);l.textContent=`${m} TON`}else l.textContent="Не удалось загрузить баланс."}}catch(a){alert("Ошибка подключения: "+a.message),console.error(a)}}document.getElementById("connectButton").addEventListener("click",Yr);
